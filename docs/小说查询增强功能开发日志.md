# 开发日志 - 小说查询增强功能

## 2026-02-18 - 小说查询增强功能设计文档

### 工作概述

根据用户反馈，为小说查询接口设计增强功能，包括按状态筛选、标签筛选、字数筛选、排序方式增强。已完成设计文档，参考用户提供的界面图进行了调整，待用户评审后开始开发。

---

## 📋 功能需求

| 序号 | 功能 | 描述 | 优先级 |
|------|------|------|--------|
| 1 | 按状态筛选 | 支持按小说状态（连载中、已完结、停更）筛选 | P0 |
| 2 | 按标签筛选 | 支持按标签筛选，标签从已有标签中选择，用户不能输入 | P0 |
| 3 | 按字数筛选 | 支持按字数范围筛选（如：100万字以下、100-300万字、300-500万字、500万字以上） | P0 |
| 4 | 排序方式 | 在现有"按更新时间降序"基础上，增加"按字数降序" | P0 |

---

## 🎯 设计重点

### 1. 查询性能优化

**分层查询策略**：
- 简单查询（单条件）：< 50ms
- 组合查询（2-3个条件）：< 200ms
- 复杂查询（4个以上条件）：< 500ms

**索引优化**：
- 单列索引：status, wordCount
- 复合索引：platform + status + wordCount, status + wordCount + updateTime

**缓存策略**：
- 标签列表缓存（5分钟）
- 查询结果缓存（2分钟）

### 2. API设计

**扩展现有接口**：
```
GET /api/crawler/novels/page?page=0&size=10&platform=ciweimao&keyword=修仙&status=1&tags=玄幻,穿越&wordCountMin=1000000&wordCountMax=3000000&sortBy=wordCount&sortOrder=desc
```

**新增接口**：
```
GET /api/crawler/novels/tags?platform=ciweimao
```

**响应格式**：
```json
{
  "success": true,
  "tags": [
    {"name": "玄幻", "count": 1250},
    {"name": "修仙", "count": 980},
    {"name": "穿越", "count": 856}
  ]
}
```

### 3. 前端界面设计

**根据用户提供的参考图调整**：
- 筛选条件横向排列：平台 → 状态 → 字数 → 排序
- 标签筛选单独一行，显示已选标签
- 顶部搜索框
- 小说卡片列表展示

**筛选组件**：
- 平台筛选（单选下拉框）
- 状态筛选（单选下拉框）：全部/连载中/已完结/停更
- 字数筛选（单选下拉框）：全部/100万字以下/100-300万字/300-500万字/500-1000万字/1000万字以上
- 标签筛选（多选下拉框）：最多选择5个，从已有标签中选择
- 排序方式（单选下拉框）：更新时间（降序/升序）、字数（降序/升序）

**交互设计**：
- 实时筛选（无需确认按钮）
- 防抖处理（延迟500ms）
- 标签多选支持模糊搜索
- 已选标签显示，支持点击删除

---

## 📊 开发计划

### 第一阶段：后端开发（预计3-4小时）

| 任务 | 工作量 | 优先级 |
|------|--------|--------|
| NovelRepository新增查询方法 | 1.5h | P0 |
| CrawlerController更新接口 | 1h | P0 |
| 新增TagsController | 0.5h | P0 |
| 数据库索引优化 | 0.5h | P0 |
| 单元测试编写 | 1.5h | P0 |
| API文档更新 | 0.5h | P1 |

**小计**：5.5小时

### 第二阶段：前端开发（预计4-5小时）

| 任务 | 工作量 | 优先级 |
|------|--------|--------|
| 筛选组件开发（状态、字数、排序） | 1.5h | P0 |
| 标签多选组件开发 | 2h | P0 |
| API接口调用更新 | 1h | P0 |
| 前端测试 | 1h | P1 |

**小计**：5.5小时

### 第三阶段：联调测试（预计2-3小时）

| 任务 | 工作量 | 优先级 |
|------|--------|--------|
| 前后端联调 | 1.5h | P0 |
| 性能测试 | 1h | P0 |
| Bug修复 | 0.5h | P1 |

**小计**：3小时

**总计**：14小时（约2个工作日）

---

## ⚠️ 待评审问题

### 1. 功能逻辑

1. **标签筛选**：是否支持"同时包含多个标签"的查询逻辑（AND）？还是"包含任一标签"（OR）？
   - **建议**：使用"包含任一标签"（OR），提高查询性能

2. **字数范围**：是否需要支持自定义字数范围？
   - **建议**：使用预设的选项，简化用户操作

3. **排序方式**：是否需要支持"按收藏数"排序？
   - **建议**：后期收藏功能完善后添加

4. **标签数量限制**：最多允许选择几个标签？
   - **建议**：最多5个，避免查询性能问题

5. **标签列表刷新频率**：标签列表多久刷新一次？
   - **建议**：5分钟一次，使用Redis缓存

### 2. 技术选型

1. **标签查询**：使用LIKE模糊查询还是JSON函数查询？
   - **建议**：先使用LIKE，性能不足时再考虑JSON函数

2. **缓存方案**：是否引入Redis？
   - **建议**：先不引入，使用本地缓存，后期再优化

3. **前端组件库**：使用Element Plus还是Ant Design Vue？
   - **建议**：使用Element Plus（与现有项目保持一致）

---

## 📁 文件清单

**新增文件**：
- `docs/小说查询增强功能设计文档.md` - 详细设计文档（16,774字）

**文档包含**：
- 需求分析
- 数据库设计
- API设计
- 查询性能优化
- 前端界面设计
- 测试计划
- 开发计划

---

## Git提交记录

### 提交1：设计文档
```
docs: 添加小说查询增强功能设计文档
提交ID: e8610dd
```

### 提交2：开发日志
```
docs: 添加小说查询增强功能开发日志
提交ID: d599efd
```

### 提交3：更新前端界面设计
```
docs: 更新前端界面设计，参考用户提供的界面图
提交ID: 739104b
更新内容：
- 添加用户提供的界面参考图说明
- 调整筛选条件布局（横向排列：平台→状态→字数→排序）
- 优化标签筛选显示（单独一行，显示已选标签）
- 确认界面设计与参考图一致
```

### GitHub推送记录

#### 推送信息
- **推送时间**: 2026-02-18 10:30
- **推送状态**: ✅ 成功
- **仓库**: https://github.com/lridea/novel-reader
- **分支**: master
- **最新提交**: 739104b

---

## 📌 下一步行动

### 待用户评审后：

1. **确认需求**：
   - [ ] 确认标签筛选逻辑（AND/OR）
   - [ ] 确认字数范围是否支持自定义
   - [ ] 确认标签数量限制
   - [ ] 确认标签列表刷新频率

2. **确认技术选型**：
   - [ ] 确认标签查询方式（LIKE/JSON函数）
   - [ ] 确认是否引入Redis
   - [ ] 确认前端组件库

3. **开始开发**：
   - [ ] 后端Repository开发
   - [ ] 后端Controller开发
   - [ ] 后端单元测试
   - [ ] 前端组件开发
   - [ ] 前后端联调
   - [ ] 性能测试
   - [ ] Bug修复

---

**文档创建时间**: 2026-02-18 10:25  
**设计状态**: 待评审  
**预计开发时间**: 14小时（约2个工作日）  
**GitHub仓库**: https://github.com/lridea/novel-reader  

🦞
