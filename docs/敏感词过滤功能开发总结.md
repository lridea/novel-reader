# æ•æ„Ÿè¯è¿‡æ»¤åŠŸèƒ½å¼€å‘æ€»ç»“

**å¼€å‘æ—¥æœŸ**: 2026-02-18
**å¼€å‘äººå‘˜**: OpenClaw
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ éœ€æ±‚å®Œæˆæƒ…å†µ

| åºå· | åŠŸèƒ½ | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| 1 | Trieæ ‘å®ç° | ä½¿ç”¨Trieæ ‘å®ç°æ•æ„Ÿè¯è¿‡æ»¤ | âœ… å·²å®ç° |
| 2 | æ•æ„Ÿè¯åº“ç®¡ç† | æ”¯æŒCRUDæ“ä½œç®¡ç†æ•æ„Ÿè¯åº“ | âœ… å·²å®ç° |
| 3 | è¯„è®ºè¿‡æ»¤ | è¯„è®ºæäº¤æ—¶è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯ | âœ… å·²å®ç° |
| 4 | æ¨¡å—éš”ç¦» | filteråŒ…å®Œå…¨ç‹¬ç«‹ï¼Œé™ä½è€¦åˆåº¦ | âœ… å·²å®ç° |

---

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…å•

### æ•°æ®åº“æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰

| æ–‡ä»¶ | è¯´æ˜ | æäº¤ID |
|------|------|--------|
| `V6__add_sensitive_word_table.sql` | æ•°æ®åº“è¿ç§»è„šæœ¬ | 170501a |

### åç«¯æ–‡ä»¶ï¼ˆ8ä¸ªï¼‰

| æ–‡ä»¶ | è¯´æ˜ | æäº¤ID |
|------|------|--------|
| `SensitiveWord.java` | æ•æ„Ÿè¯å®ä½“ | 170501a |
| `SensitiveWordRepository.java` | æ•æ„Ÿè¯Repository | 170501a |
| `TrieNode.java` | Trieæ ‘èŠ‚ç‚¹ | 170501a |
| `TrieTree.java` | Trieæ ‘ | 170501a |
| `FilterResult.java` | è¿‡æ»¤ç»“æœ | 170501a |
| `SensitiveWordFilter.java` | æ•æ„Ÿè¯è¿‡æ»¤å™¨ | 170501a |
| `SensitiveWordService.java` | æ•æ„Ÿè¯ç®¡ç†æœåŠ¡ | e343119 |
| `SensitiveWordController.java` | æ•æ„Ÿè¯ç®¡ç†API | e343119 |
| `CommentService.java` | é›†æˆæ•æ„Ÿè¯è¿‡æ»¤ | e343119 |

---

## ğŸŒ APIæ¥å£

### 1. è·å–æ•æ„Ÿè¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰

**æ¥å£è·¯å¾„**: `GET /api/sensitive-words`

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆä»0å¼€å§‹ï¼Œé»˜è®¤0ï¼‰
- `size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
- `category`: åˆ†ç±»ï¼ˆå¯é€‰ï¼‰
- `enabled`: çŠ¶æ€ï¼ˆå¯é€‰ï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "content": [
    {
      "id": 1,
      "word": "æš´åŠ›",
      "category": "æš´åŠ›",
      "severity": 2,
      "enabled": 1,
      "createdAt": "2026-02-18T08:00:00",
      "updatedAt": "2026-02-18T08:00:00"
    }
  ],
  "totalElements": 15,
  "totalPages": 2
}
```

---

### 2. æ·»åŠ æ•æ„Ÿè¯

**æ¥å£è·¯å¾„**: `POST /api/sensitive-words`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "word": "æš´åŠ›",
  "category": "æš´åŠ›",
  "severity": 2
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "message": "æ·»åŠ æˆåŠŸ",
  "sensitiveWord": {...}
}
```

---

### 3. æ›´æ–°æ•æ„Ÿè¯

**æ¥å£è·¯å¾„**: `PUT /api/sensitive-words/{id}`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "word": "æš´åŠ›",
  "category": "æš´åŠ›",
  "severity": 2,
  "enabled": 1
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "message": "æ›´æ–°æˆåŠŸ",
  "sensitiveWord": {...}
}
```

---

### 4. åˆ é™¤æ•æ„Ÿè¯

**æ¥å£è·¯å¾„**: `DELETE /api/sensitive-words/{id}`

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

### 5. æµ‹è¯•æ–‡æœ¬

**æ¥å£è·¯å¾„**: `POST /api/sensitive-words/test`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "text": "è¿™æ˜¯ä¸€æ¡åŒ…å«æš´åŠ›çš„è¯„è®º"
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "isSensitive": true
}
```

---

## ğŸ”§ åç«¯å®ç°

### 1. æ•°æ®åº“è®¾è®¡

#### t_sensitive_wordè¡¨ï¼ˆæ–°å»ºï¼‰

```sql
CREATE TABLE IF NOT EXISTS t_sensitive_word (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    word VARCHAR(100) NOT NULL COMMENT 'æ•æ„Ÿè¯',
    category VARCHAR(50) COMMENT 'åˆ†ç±»ï¼šæ”¿æ²»ã€è‰²æƒ…ã€æš´åŠ›ã€å¹¿å‘Šç­‰',
    severity TINYINT DEFAULT 1 COMMENT 'ä¸¥é‡ç¨‹åº¦ï¼š1-è½»å¾®ï¼Œ2-ä¸¥é‡ï¼Œ3-ç¦æ­¢',
    enabled TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    UNIQUE KEY uk_word (word),
    INDEX idx_category (category),
    INDEX idx_enabled (enabled)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ•æ„Ÿè¯è¡¨';
```

---

### 2. Trieæ ‘å®ç°

#### TrieNodeï¼ˆTrieæ ‘èŠ‚ç‚¹ï¼‰

```java
public class TrieNode {
    private Map<Character, TrieNode> children;  // å­èŠ‚ç‚¹
    private boolean isEnd;                      // æ˜¯å¦ä¸ºæ•æ„Ÿè¯ç»“å°¾
    private String word;                        // æ•æ„Ÿè¯å†…å®¹
}
```

#### TrieTreeï¼ˆTrieæ ‘ï¼‰

```java
public class TrieTree {
    private TrieNode root;

    public void insert(String word) {
        // æ’å…¥æ•æ„Ÿè¯åˆ°Trieæ ‘
    }

    public void insertBatch(List<String> words) {
        // æ‰¹é‡æ’å…¥æ•æ„Ÿè¯
    }

    public boolean contains(String text) {
        // æœç´¢æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
    }

    public String filter(String text) {
        // è¿‡æ»¤æ–‡æœ¬ï¼ˆæ›¿æ¢æ•æ„Ÿè¯ä¸º***ï¼‰
    }

    public List<String> getSensitiveWords(String text) {
        // è·å–æ–‡æœ¬ä¸­çš„æ‰€æœ‰æ•æ„Ÿè¯
    }
}
```

---

### 3. SensitiveWordFilterï¼ˆæ•æ„Ÿè¯è¿‡æ»¤å™¨ï¼‰

```java
@Component
public class SensitiveWordFilter {

    @PostConstruct
    public void init() {
        // åˆå§‹åŒ–Trieæ ‘ï¼ˆä»æ•°æ®åº“åŠ è½½æ‰€æœ‰å¯ç”¨çš„æ•æ„Ÿè¯ï¼‰
    }

    public boolean isSensitive(String text) {
        // æ£€æŸ¥æ–‡æœ¬æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
    }

    public FilterResult filter(String text) {
        // è¿‡æ»¤æ–‡æœ¬ï¼ˆæ›¿æ¢æ•æ„Ÿè¯ä¸º***ï¼‰
    }

    public void reload() {
        // é‡æ–°åŠ è½½æ•æ„Ÿè¯åº“
    }
}
```

---

### 4. æ¨¡å—éš”ç¦»è®¾è®¡

#### åŒ…ç»“æ„

```
com.novelreader
â”œâ”€â”€ filter                    # æ•æ„Ÿè¯è¿‡æ»¤æ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ trie                 # Trieæ ‘å®ç°
â”‚   â”‚   â”œâ”€â”€ TrieNode.java
â”‚   â”‚   â””â”€â”€ TrieTree.java
â”‚   â”œâ”€â”€ FilterResult.java    # è¿‡æ»¤ç»“æœ
â”‚   â””â”€â”€ SensitiveWordFilter.java  # æ•æ„Ÿè¯è¿‡æ»¤å™¨
â”œâ”€â”€ service                  # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ CommentService.java  # è¯„è®ºæœåŠ¡ï¼ˆè°ƒç”¨SensitiveWordFilterï¼‰
â”‚   â””â”€â”€ SensitiveWordService.java  # æ•æ„Ÿè¯ç®¡ç†æœåŠ¡
â””â”€â”€ controller               # æ§åˆ¶å™¨
    â”œâ”€â”€ CommentController.java  # è¯„è®ºæ§åˆ¶å™¨
    â””â”€â”€ SensitiveWordController.java  # æ•æ„Ÿè¯ç®¡ç†æ§åˆ¶å™¨
```

---

#### æ¨¡å—éš”ç¦»ä¼˜åŠ¿

1. **filteråŒ…å®Œå…¨ç‹¬ç«‹**
   - ä¸ä¾èµ–è¯„è®ºæ¨¡å—
   - å¯ä»¥å•ç‹¬æµ‹è¯•
   - é™ä½è€¦åˆåº¦

2. **CommentServiceåªè°ƒç”¨SensitiveWordFilter**
   - åªè°ƒç”¨filteræ–¹æ³•
   - ä¸å…³å¿ƒå†…éƒ¨å®ç°
   - æ¥å£ç®€æ´

3. **SensitiveWordFilterä¸ä¾èµ–è¯„è®ºæ¨¡å—**
   - å®Œå…¨ç‹¬ç«‹
   - å¯å¤ç”¨æ€§å¼º
   - æ˜“äºç»´æŠ¤

---

### 5. é›†æˆåˆ°è¯„è®ºæ¨¡å—

#### CommentServiceæ›´æ–°

```java
@Service
public class CommentService {

    @Autowired
    private SensitiveWordFilter sensitiveWordFilter;

    @Transactional
    public Map<String, Object> addComment(...) {
        // ...

        // æ•æ„Ÿè¯è¿‡æ»¤
        FilterResult filterResult = sensitiveWordFilter.filter(content);
        if (filterResult.isSensitive()) {
            result.put("success", false);
            result.put("message", "è¯„è®ºåŒ…å«æ•æ„Ÿè¯ï¼Œæ— æ³•å‘å¸ƒ");
            return result;
        }

        // åˆ›å»ºè¯„è®º
        // ...
    }
}
```

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. Trieæ ‘ç®—æ³•

**æ—¶é—´å¤æ‚åº¦**ï¼šO(n)ï¼Œå…¶ä¸­næ˜¯æ–‡æœ¬é•¿åº¦

**ä¼˜ç‚¹**ï¼š
- æŸ¥è¯¢é€Ÿåº¦å¿«
- æ”¯æŒæ‰¹é‡æ’å…¥
- å†…å­˜å ç”¨å°

---

### 2. æ¨¡å—éš”ç¦»

**è®¾è®¡åŸåˆ™**ï¼š
- filteråŒ…å®Œå…¨ç‹¬ç«‹
- é™ä½è€¦åˆåº¦
- æé«˜å¯ç»´æŠ¤æ€§

---

### 3. åŠ¨æ€åŠ è½½

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨@PostConstructåˆå§‹åŒ–
- æ”¯æŒreloadé‡æ–°åŠ è½½
- æ•æ„Ÿè¯æ›´æ–°åè‡ªåŠ¨ç”Ÿæ•ˆ

---

### 4. åˆ†ç±»ç®¡ç†

**åˆ†ç±»**ï¼š
- æ”¿æ²»
- è‰²æƒ…
- æš´åŠ›
- å¹¿å‘Š

**ä¸¥é‡ç¨‹åº¦**ï¼š
- 1-è½»å¾®
- 2-ä¸¥é‡
- 3-ç¦æ­¢

---

## ğŸ“Š å¼€å‘è¿›åº¦

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ | çŠ¶æ€ |
|------|------|--------|------|
| æ•°æ®åº“è®¾è®¡ | åˆ›å»ºæ•æ„Ÿè¯è¡¨ | 0.5h | âœ… å·²å®Œæˆ |
| Trieæ ‘å®ç° | TrieNodeå’ŒTrieTree | 1h | âœ… å·²å®Œæˆ |
| è¿‡æ»¤æœåŠ¡ | SensitiveWordFilter | 0.5h | âœ… å·²å®Œæˆ |
| ç®¡ç†æœåŠ¡ | SensitiveWordService | 1h | âœ… å·²å®Œæˆ |
| ç®¡ç†API | SensitiveWordController | 0.5h | âœ… å·²å®Œæˆ |
| é›†æˆè¯„è®ºæ¨¡å— | CommentServiceæ›´æ–° | 0.5h | âœ… å·²å®Œæˆ |

**æ€»è®¡**: çº¦4å°æ—¶

---

## ğŸ¯ Gitæäº¤è®°å½•

| æäº¤ID | æäº¤ä¿¡æ¯ | æ—¶é—´ |
|--------|---------|------|
| 170501a | feat: æ·»åŠ æ•æ„Ÿè¯è¿‡æ»¤æ¨¡å—ï¼ˆåŸºäºTrieæ ‘ï¼‰ | 15:00 |
| e343119 | feat: æ·»åŠ æ•æ„Ÿè¯ç®¡ç†æœåŠ¡å’ŒAPI | 15:05 |

### GitHubæ¨é€è®°å½•

- **ä»“åº“**: https://github.com/lridea/novel-reader
- **åˆ†æ”¯**: master
- **æœ€æ–°æäº¤**: e343119
- **æäº¤æ€»æ•°**: 2ä¸ª

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [x] Trieæ ‘æ­£ç¡®å®ç°
- [x] æ•æ„Ÿè¯æ­£ç¡®åŒ¹é…
- [x] è¯„è®ºæäº¤æ—¶è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯
- [x] æ•æ„Ÿè¯ç®¡ç†CRUDåŠŸèƒ½æ­£å¸¸
- [x] æ¨¡å—éš”ç¦»æ­£ç¡®å®ç°
- [x] filteråŒ…å®Œå…¨ç‹¬ç«‹

---

### æ€§èƒ½éªŒæ”¶

- [ ] æ•æ„Ÿè¯è¿‡æ»¤ < 10ms
- [ ] Trieæ ‘åˆå§‹åŒ– < 1s
- [ ] æ•æ„Ÿè¯åº“åŠ è½½ < 1s

---

### å…¼å®¹æ€§éªŒæ”¶

- [x] è¯„è®ºæ¨¡å—æ­£ç¡®é›†æˆ
- [x] æœªç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®æ•æ„Ÿè¯ç®¡ç†
- [x] æ•æ„Ÿè¯æ›´æ–°åè‡ªåŠ¨ç”Ÿæ•ˆ

---

## ğŸ“ å¾…åŠäº‹é¡¹

### åŠŸèƒ½å¾…ä¼˜åŒ–

- [ ] æ•æ„Ÿè¯å¯¼å…¥/å¯¼å‡º
- [ ] æ‰¹é‡æ·»åŠ æ•æ„Ÿè¯
- [ ] æ•æ„Ÿè¯åˆ†ç±»ç»Ÿè®¡
- [ ] æ•æ„Ÿè¯å‘½ä¸­ç‡ç»Ÿè®¡

### æ€§èƒ½ä¼˜åŒ–

- [ ] æ•æ„Ÿè¯åº“ç¼“å­˜
- [ ] Trieæ ‘ä¼˜åŒ–
- [ ] å¹¶å‘æµ‹è¯•

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æƒé™æ§åˆ¶

1. **æœªç™»å½•ç”¨æˆ·**ï¼šæ— æ³•è®¿é—®æ•æ„Ÿè¯ç®¡ç†API
2. **å·²ç™»å½•ç”¨æˆ·**ï¼šå¯ä»¥ç®¡ç†æ•æ„Ÿè¯
3. **ç®¡ç†å‘˜**ï¼šå¯ä»¥åˆ é™¤æ‰€æœ‰æ•æ„Ÿè¯ï¼ˆå¾…å®ç°ï¼‰

---

### 2. å¹¶å‘é—®é¢˜

1. âœ… **æ•æ„Ÿè¯æ›´æ–°**ï¼šä½¿ç”¨@Transactionalï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
2. âœ… **Trieæ ‘é‡è½½**ï¼šæ¯æ¬¡æ›´æ–°åè‡ªåŠ¨é‡è½½ï¼Œä¿è¯æ•°æ®æœ€æ–°

---

### 3. æ•°æ®ä¸€è‡´æ€§

1. âœ… **æ•æ„Ÿè¯åº“**ï¼šæ¯æ¬¡æ›´æ–°åè‡ªåŠ¨é‡è½½Trieæ ‘
2. âœ… **è¯„è®ºè¿‡æ»¤**ï¼šä½¿ç”¨æœ€æ–°çš„æ•æ„Ÿè¯åº“è¿‡æ»¤

---

## ğŸ† æ€»ç»“

### å®Œæˆæƒ…å†µ

âœ… **æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®Œæˆ**ï¼š
- Trieæ ‘å®ç°
- æ•æ„Ÿè¯åº“ç®¡ç†
- è¯„è®ºè¿‡æ»¤
- æ¨¡å—éš”ç¦»

---

### æŠ€æœ¯äº®ç‚¹

1. âœ… **Trieæ ‘ç®—æ³•**ï¼šæŸ¥è¯¢é€Ÿåº¦å¿«
2. âœ… **æ¨¡å—éš”ç¦»**ï¼šé™ä½è€¦åˆåº¦
3. âœ… **åŠ¨æ€åŠ è½½**ï¼šæ”¯æŒçƒ­æ›´æ–°
4. âœ… **åˆ†ç±»ç®¡ç†**ï¼šæ”¯æŒå¤šåˆ†ç±»

---

### åç»­ä¼˜åŒ–

1. âš ï¸ **æ€§èƒ½ä¼˜åŒ–**ï¼šæ•æ„Ÿè¯åº“ç¼“å­˜ã€Trieæ ‘ä¼˜åŒ–
2. âš ï¸ **åŠŸèƒ½æ‰©å±•**ï¼šæ‰¹é‡æ“ä½œã€ç»Ÿè®¡åŠŸèƒ½

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2026-02-18 15:05
**å¼€å‘äººå‘˜**: OpenClaw
**GitHubä»“åº“**: https://github.com/lridea/novel-reader
**æœ€æ–°æäº¤**: e343119
**å¼€å‘çŠ¶æ€**: âœ… æ•æ„Ÿè¯è¿‡æ»¤åŠŸèƒ½å·²å®Œæˆï¼Œæ¨¡å—éš”ç¦»æ­£ç¡®å®ç°

ğŸ¦
