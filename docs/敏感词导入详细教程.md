# 敏感词导入详细教程

**开发日期**: 2026-02-18
**开发人员**: OpenClaw

---

## 📥 导入方式对比

| 方式 | 难度 | 速度 | 适用场景 | 推荐度 |
|------|------|------|---------|--------|
| Python脚本 | ⭐⭐ | 快 | 大批量导入 | ⭐⭐⭐⭐⭐ |
| SQL脚本 | ⭐ | 最快 | 数据库直接操作 | ⭐⭐⭐⭐ |
| API导入 | ⭐⭐⭐ | 中 | 少量导入 | ⭐⭐⭐ |

---

## 方式一：Python脚本导入（推荐）⭐⭐⭐⭐⭐

### 适用场景
- ✅ 大批量导入（1000+敏感词）
- ✅ 需要实时反馈
- ✅ 需要错误处理

### 步骤

#### 1. 安装Python依赖

```bash
pip3 install requests
```

#### 2. 修改配置

编辑 `scripts/import_sensitive_words.py`，修改以下配置：

```python
# 配置
API_BASE_URL = "http://localhost:8080/api/sensitive-words"
TOKEN = "YOUR_TOKEN"  # 替换为你的Token
```

**如何获取Token？**

1. 登录你的应用
2. 从登录响应中获取JWT Token
3. 或者使用Postman登录后获取Token

#### 3. 准备敏感词文件

格式（`scripts/sensitive_words_test.txt`）：

```
## 分类名称
敏感词1
敏感词2
...
```

#### 4. 运行导入脚本

```bash
cd novel-reader/scripts
python3 import_sensitive_words.py sensitive_words_test.txt
```

#### 5. 输出示例

```
正在读取敏感词文件: sensitive_words_test.txt
共读取 6 个分类，50 个敏感词

正在导入分类: 政治类 (6 个敏感词)
  批次 1: 导入 6 个敏感词... 成功 6, 跳过 0

正在导入分类: 违法类 (18 个敏感词)
  批次 1: 导入 18 个敏感词... 成功 18, 跳过 0

...

导入完成！
```

---

## 方式二：SQL脚本导入（最快）⭐⭐⭐⭐

### 适用场景
- ✅ 快速导入大量敏感词
- ✅ 有数据库访问权限
- ✅ 不需要API

### 步骤

#### 1. 准备SQL脚本

使用 `scripts/import_sensitive_words.sql`，格式如下：

```sql
INSERT INTO t_sensitive_word (word, category, severity, enabled, created_at, updated_at) VALUES
('暴力', '暴力', 2, 1, NOW(), NOW()),
('色情', '色情', 3, 1, NOW(), NOW()),
...
```

#### 2. 导入到数据库

```bash
# 方式1：使用MySQL命令行
mysql -u username -p novel_reader_database < import_sensitive_words.sql

# 方式2：使用MySQL Workbench
# 打开MySQL Workbench，执行SQL脚本

# 方式3：使用phpMyAdmin
# 打开phpMyAdmin，导入SQL文件
```

#### 3. 验证导入

```sql
-- 查询敏感词数量
SELECT COUNT(*) FROM t_sensitive_word;

-- 查询敏感词列表
SELECT * FROM t_sensitive_word LIMIT 10;

-- 按分类统计
SELECT category, COUNT(*) as count
FROM t_sensitive_word
GROUP BY category;
```

#### 4. 重启应用

```bash
# 重启Spring Boot应用，让Trie树重新加载敏感词库
mvn spring-boot:run
# 或者
java -jar target/novel-reader-backend.jar
```

---

## 方式三：API导入（简单）⭐⭐⭐

### 适用场景
- ✅ 少量导入（<100个）
- ✅ 需要实时验证
- ✅ 前端调用

### 步骤

#### 1. 登录获取Token

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "your_username",
    "password": "your_password"
  }'
```

响应：
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

#### 2. 导入敏感词

```bash
curl -X POST http://localhost:8080/api/sensitive-words/import \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "words": ["暴力", "色情", "毒品", "赌博", "诈骗"]
  }'
```

响应：
```json
{
  "success": true,
  "message": "导入成功",
  "successCount": 5,
  "skipCount": 0
}
```

#### 3. 验证导入

```bash
curl -X GET http://localhost:8080/api/sensitive-words?page=0&size=10 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 🎯 我的推荐

### 对于你的小说阅读器项目：

**推荐顺序**：

1. **第一次导入**：使用SQL脚本
   - 快速导入示例数据
   - 立即测试功能

2. **后续更新**：使用Python脚本
   - 下载开源敏感词库
   - 批量导入大量敏感词

3. **日常维护**：使用API
   - 添加少量敏感词
   - 前端调用

---

## 📁 文件位置

- **Python导入脚本**: `scripts/import_sensitive_words.py`
- **测试用敏感词文件**: `scripts/sensitive_words_test.txt`
- **SQL导入脚本**: `scripts/import_sensitive_words.sql`
- **使用教程**: `docs/敏感词导入教程.md`

---

## 🔍 验证导入

### 方式1：通过API验证

```bash
# 查询敏感词总数
curl -X GET "http://localhost:8080/api/sensitive-words?page=0&size=1" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 测试敏感词过滤
curl -X POST http://localhost:8080/api/sensitive-words/test \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"text": "这是一条包含暴力的评论"}'
```

响应：
```json
{
  "success": true,
  "isSensitive": true
}
```

---

### 方式2：通过数据库验证

```sql
-- 查询敏感词总数
SELECT COUNT(*) FROM t_sensitive_word;

-- 按分类统计
SELECT category, COUNT(*) as count
FROM t_sensitive_word
GROUP BY category;

-- 查询特定分类的敏感词
SELECT * FROM t_sensitive_word
WHERE category = '暴力'
LIMIT 10;
```

---

## ⚠️ 注意事项

### 1. Token获取

- Token需要通过登录API获取
- Token有效期通常是24小时
- 过期后需要重新登录

---

### 2. 批量导入限制

- Python脚本：每批100个敏感词
- API导入：建议每次不超过100个敏感词
- SQL脚本：无限制

---

### 3. 重复导入

- 已存在的敏感词会被跳过
- skipCount字段会显示跳过的数量
- 不会重复插入

---

### 4. Trie树重载

- SQL导入后需要重启应用
- Python/API导入会自动重载Trie树
- 也可以调用reload API手动重载

---

## 🚀 快速开始

### 1. 快速测试（使用SQL）

```bash
# 导入SQL脚本
mysql -u root -p novel_reader_database < scripts/import_sensitive_words.sql

# 重启应用
mvn spring-boot:run

# 测试敏感词过滤
curl -X POST http://localhost:8080/api/sensitive-words/test \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"text": "这是一条包含暴力的评论"}'
```

---

### 2. 大批量导入（使用Python）

```bash
# 安装依赖
pip3 install requests

# 修改配置
vim scripts/import_sensitive_words.py

# 运行导入
python3 scripts/import_sensitive_words.py scripts/sensitive_words_test.txt
```

---

### 3. 少量导入（使用API）

```bash
# 导入敏感词
curl -X POST http://localhost:8080/api/sensitive-words/import \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "words": ["暴力", "色情", "毒品", "赌博", "诈骗"]
  }'
```

---

🦞
