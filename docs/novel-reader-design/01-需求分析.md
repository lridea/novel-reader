# 读书网站 - 需求分析文档

## 📌 项目概述

### 项目目标
开发一个定时抓取多个小说平台最新内容的读书网站，提供基于标签的智能筛选、内容展示和用户收藏管理功能。

### 目标用户
- 小说爱好者：方便查看多个平台的最新更新
- 追更党：及时获取喜欢的小说更新通知
- 分类收藏者：管理大量收藏的书籍

---

## 🎯 核心功能需求

### 1. 数据抓取模块（最高优先级）

#### 1.1 支持平台
| 平台 | 状态 | 说明 |
|------|------|------|
| 刺猬猫 | P0 | 必须支持 |
| SF轻小说 | P0 | 必须支持 |
| 次元姬 | P0 | 必须支持 |
| 起点中文网 | P0 | 必须支持 |

#### 1.2 抓取内容
| 字段 | 类型 | 说明 | 必填 |
|------|------|------|------|
| 唯一ID | String | 平台内唯一标识 | ✅ |
| 书籍名称 | String | 小说标题 | ✅ |
| 简介 | String | 内容简介 | ✅ |
| 作者 | String | 作者名 | ✅ |
| 标签 | Array<String> | 标签列表（过滤条件） | ✅ |
| 封面 | String | 封面图片URL | ✅ |
| 最新更新时间 | DateTime | 最后更新时间 | ✅ |
| 最新章节标题 | String | 最新章节名 | ✅ |
| 最新章节内容 | String | 最新章节全文（首次抓取前几章） | ✅ |
| AI概括 | String | AI生成的章节概括 | ✅ |
| 平台来源 | String | 标识来源平台 | ✅ |
| 抓取时间 | DateTime | 抓取记录时间 | ✅ |

#### 1.3 抓取策略
- **频率**：每2小时执行一次（可配置）
- **标签过滤**：只抓取特定标签的书籍（用户配置）
- **首次抓取**：
  - 抓取前3-5章内容
  - 调用AI接口生成章节概括
  - 存储到数据库
- **增量更新**：
  - 只抓取更新的小说
  - 对比最新更新时间
  - 有更新则更新数据库

#### 1.4 反爬虫应对
- 使用代理IP池
- 随机User-Agent
- 请求频率限制
- 模拟浏览器行为

---

### 2. 查询展示模块

#### 2.1 列表展示
- **默认排序**：最新更新时间降序
- **分页**：每页20条（可配置）
- **展示字段**：
  - 封面图
  - 书名
  - 作者
  - 标签
  - 简介（截断显示）
  - 最新更新时间
  - 最新章节标题
  - AI概括（hover显示）

#### 2.2 筛选功能
- **按平台**：多选平台过滤
- **按标签**：多选标签过滤
- **按时间**：更新时间范围
- **搜索**：书名/作者模糊搜索

#### 2.3 书籍详情
- 完整简介
- 完整标签列表
- 封面大图
- 作者信息
- 最新章节内容
- 历史章节列表（可选，P1）
- 收藏按钮（登录后）

---

### 3. 用户系统（P0）

#### 3.1 注册/登录
- **注册方式**：
  - 邮箱注册
  - 手机号注册（可选）
- **登录方式**：
  - 账号密码登录
  - 邮箱验证码登录
- **密码加密**：BCrypt
- **Session管理**：JWT Token

#### 3.2 用户信息
- 昵称
- 邮箱
- 头像（可选）
- 注册时间

---

### 4. 收藏管理模块（P0）

#### 4.1 收藏功能
- 添加收藏
- 取消收藏
- 批量收藏

#### 4.2 分类管理
- 创建自定义分类
- 重命名分类
- 删除分类
- 将书籍分类到多个分类

#### 4.3 收藏列表
- 按分类查看
- 按更新时间排序
- 显示是否有新更新

#### 4.4 更新提醒（P1）
- 收藏书籍有更新时通知
- 邮件通知（可选）
- 站内信通知

---

### 5. AI概括模块（P0）

#### 5.1 AI API调用
- **推荐**：智谱AI（GLM-4）
- **备选**：OpenAI GPT-4
- **用途**：
  - 章节内容概括（100-200字）
  - 简介优化（可选）
  - 标签生成（可选）

#### 5.2 概括策略
- 只在首次抓取时生成概括
- 缓存概括结果
- 避免重复调用API（成本控制）

---

## 🚀 技术选型建议

### 后端（Java）
- **框架**：Spring Boot 3.2.x
- **数据库ORM**：Spring Data JPA
- **爬虫框架**：Jsoup + OkHttp
- **定时任务**：Spring @Scheduled
- **API文档**：SpringDoc OpenAPI 3
- **测试**：JUnit 5 + Mockito
- **日志**：Logback + SLF4J

### 前端（强烈推荐）
- **框架**：Vue 3 + TypeScript
- **跨平台**：Uni-app（一套代码：H5 + 小程序 + APP）
- **状态管理**：Pinia
- **UI组件库**：Element Plus / uView
- **HTTP客户端**：Axios
- **构建工具**：Vite

### 数据库（推荐）
- **主数据库**：PostgreSQL 15
  - 理由：
    - 支持全文搜索（适合小说搜索）
    - JSONB字段（灵活存储标签、元数据）
    - 强大的查询能力
    - 事务支持好
- **缓存**：Redis 7
  - 缓存热门书籍列表
  - 存储用户Session
  - 分布式锁

### 消息队列（可选，P1）
- **RabbitMQ**：异步处理抓取任务
- 减轻定时任务压力
- 提高抓取效率

### 部署
- **容器化**：Docker + Docker Compose
- **反向代理**：Nginx
- **进程管理**：systemd
- **监控**：Prometheus + Grafana（可选）

---

## 📊 数据量预估

### 书籍数据
- 每次抓取：每个平台约500-1000本新书
- 标签过滤后：约200-300本/平台
- 4个平台：约800-1200本/次
- 每天抓取12次：约10000-15000本/天
- 数据增长：约300,000本/月

### 用户数据
- 预估：1000-5000用户
- 每用户收藏：平均50-100本
- 收藏记录：50,000-500,000条

### 存储需求
- 书籍数据：平均1KB/本
- 月增长：300MB
- 年增长：3.6GB
- 建议：50GB存储（充足）

---

## ⚡ 性能要求

### 响应时间
- 首页加载：< 2秒
- 列表翻页：< 1秒
- 书籍详情：< 1秒
- 搜索查询：< 2秒

### 并发能力
- 支持500+ QPS
- 峰值1000+ QPS

### 可用性
- 系统可用性：99.9%
- 数据备份：每日全量备份

---

## 🔐 安全要求

### 数据安全
- 用户密码：BCrypt加密
- API接口：JWT Token认证
- HTTPS：强制使用
- SQL注入防护：JPA参数化查询
- XSS防护：前端输入验证

### 访问控制
- 接口限流：防止暴力请求
- IP白名单：管理后台
- 权限管理：RBAC（后续扩展）

---

## 📱 扩展性考虑

### APP端
- 使用Uni-app，一套代码多端运行
- H5 + 小程序 + Android + iOS
- 后端API复用

### 后续功能（P2）
- 评论系统
- 评分系统
- 推荐算法
- 社交分享
- 阅读记录
- 夜间模式
- 书籍对比
- 数据统计

---

## ✅ 需求优先级

| 模块 | 优先级 | 说明 |
|------|--------|------|
| 数据抓取 | P0 | 核心功能，必须实现 |
| 查询展示 | P0 | 核心功能，必须实现 |
| 用户系统 | P0 | 基础功能，必须实现 |
| 收藏管理 | P0 | 基础功能，必须实现 |
| AI概括 | P0 | 核心功能，必须实现 |
| 更新提醒 | P1 | 重要功能，第二阶段 |
| 评论评分 | P2 | 扩展功能，第三阶段 |
| 推荐系统 | P2 | 扩展功能，第三阶段 |

---

## 📝 下一步

请评估此需求文档是否符合预期，如需调整请反馈。确认后将进行：
1. 数据库设计
2. 后端API设计
3. 前端页面设计
4. 系统架构设计
