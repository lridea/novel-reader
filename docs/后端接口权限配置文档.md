# åç«¯æ¥å£æƒé™é…ç½®æ–‡æ¡£

**å¼€å‘æ—¥æœŸ**: 2026-02-18
**å¼€å‘äººå‘˜**: OpenClaw

---

## ğŸ“‹ æƒé™é…ç½®æ€»è§ˆ

| Controller | å…¬å¼€ | éœ€è¦ç™»å½• | ç®¡ç†å‘˜ |
|-----------|------|---------|--------|
| AuthController | âœ… | âœ… | - |
| CommentController | âœ… | âœ… | - |
| ConfigController | âœ… | - | - |
| CrawlerController | âœ… | - | - |
| FavoriteController | - | âœ… | - |
| FavoriteCategoryController | - | âœ… | - |
| SensitiveWordController | - | - | âœ… |
| TagsController | âœ… | - | - |
| TaskController | âœ… | - | - |
| UserController | âœ… | âœ… | - |

---

## ä¸€ã€AuthControllerï¼ˆè®¤è¯æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/auth`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/register` | POST | å…¬å¼€ | ç”¨æˆ·æ³¨å†Œ |
| `/login` | POST | å…¬å¼€ | ç”¨æˆ·ç™»å½• |
| `/me` | GET | éœ€è¦ç™»å½• | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| `/logout` | POST | å…¬å¼€ | ç”¨æˆ·æ³¨é”€ |

---

### æƒé™éªŒè¯ä»£ç 

```java
@GetMapping("/me")
public Map<String, Object> getCurrentUser(HttpServletRequest request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if (authentication == null || !authentication.isAuthenticated() ||
        "anonymousUser".equals(authentication.getPrincipal())) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    return userService.getUserById(userId);
}
```

---

## äºŒã€CommentControllerï¼ˆè¯„è®ºæ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/comments`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/novel/{novelId}` | GET | å…¬å¼€ | è·å–è¯„è®ºåˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰|
| `/` | POST | éœ€è¦ç™»å½• | æ·»åŠ è¯„è®º |
| `/{id}/like` | POST | éœ€è¦ç™»å½• | ç‚¹èµè¯„è®º |
| `/{id}/like` | DELETE | éœ€è¦ç™»å½• | å–æ¶ˆç‚¹èµè¯„è®º |

---

### æƒé™éªŒè¯ä»£ç 

```java
@PostMapping
public Map<String, Object> addComment(
        @RequestBody Map<String, Object> request,
        Authentication authentication
) {
    log.info("æ·»åŠ è¯„è®º: {}", request);

    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "è¯·å…ˆç™»å½•");
        return result;
    }

    User user = (User) authentication.getPrincipal();
    return commentService.addComment(user.getId(), ...);
}
```

---

## ä¸‰ã€ConfigControllerï¼ˆçˆ¬è™«é…ç½®æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/crawler/configs`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | GET | å…¬å¼€ | è·å–æ‰€æœ‰é…ç½® |
| `/{id}` | GET | å…¬å¼€ | æ ¹æ®IDè·å–é…ç½® |
| `/{id}` | PUT | å…¬å¼€ | æ›´æ–°é…ç½® |
| `/platform/{platform}` | GET | å…¬å¼€ | æ ¹æ®å¹³å°è·å–é…ç½® |

---

**æ³¨æ„**: æ‰€æœ‰æ¥å£éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ²¡æœ‰æƒé™éªŒè¯ï¼

---

## å››ã€CrawlerControllerï¼ˆçˆ¬è™«æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/crawler`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/trigger` | POST | å…¬å¼€ | è§¦å‘çˆ¬è™«ä»»åŠ¡ |
| `/trigger/{platform}` | POST | å…¬å¼€ | è§¦å‘æŒ‡å®šå¹³å°çˆ¬è™« |
| `/test/{platform}` | GET | å…¬å¼€ | æµ‹è¯•çˆ¬è™« |
| `/status/{platform}` | GET | å…¬å¼€ | è·å–çˆ¬è™«çŠ¶æ€ |
| `/novels` | GET | å…¬å¼€ | è·å–å°è¯´åˆ—è¡¨ |
| `/novels/page` | GET | å…¬å¼€ | è·å–å°è¯´åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰|
| `/novels/platform/{platform}` | GET | å…¬å¼€ | æ ¹æ®å¹³å°è·å–å°è¯´ |
| `/configs` | GET | å…¬å¼€ | è·å–çˆ¬è™«é…ç½® |
| `/crawlers` | GET | å…¬å¼€ | è·å–çˆ¬è™«åˆ—è¡¨ |
| `/health` | GET | å…¬å¼€ | å¥åº·æ£€æŸ¥ |

---

**æ³¨æ„**: æ‰€æœ‰æ¥å£éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ²¡æœ‰æƒé™éªŒè¯ï¼

---

## äº”ã€FavoriteControllerï¼ˆæ”¶è—æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/favorites`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | POST | éœ€è¦ç™»å½• | æ·»åŠ æ”¶è— |
| `/{novelId}` | DELETE | éœ€è¦ç™»å½• | å–æ¶ˆæ”¶è— |
| `/` | GET | éœ€è¦ç™»å½• | è·å–æ”¶è—åˆ—è¡¨ |
| `/{novelId}/note` | PUT | éœ€è¦ç™»å½• | æ›´æ–°æ”¶è—å¤‡æ³¨ |
| `/check-batch` | GET | æœªç™»å½•è¿”å›ç©ºï¼Œç™»å½•è¿”å›æ•°æ® | æ‰¹é‡æŸ¥è¯¢æ”¶è—çŠ¶æ€ |

---

### æƒé™éªŒè¯ä»£ç 

```java
@PostMapping
public Map<String, Object> addFavorite(@RequestBody Map<String, Object> request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    return favoriteService.addFavorite(userId, novelId, note);
}
```

---

## å…­ã€FavoriteCategoryControllerï¼ˆæ”¶è—åˆ†ç±»æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/categories`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | POST | éœ€è¦ç™»å½• | åˆ›å»ºåˆ†ç±» |
| `/` | GET | éœ€è¦ç™»å½• | è·å–åˆ†ç±»åˆ—è¡¨ |
| `/{id}` | PUT | éœ€è¦ç™»å½• | æ›´æ–°åˆ†ç±» |
| `/{id}` | DELETE | éœ€è¦ç™»å½• | åˆ é™¤åˆ†ç±» |

---

### æƒé™éªŒè¯ä»£ç 

```java
@PostMapping
public Map<String, Object> createCategory(@RequestBody Map<String, String> request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    return favoriteCategoryService.createCategory(userId, name, description);
}
```

---

## ä¸ƒã€SensitiveWordControllerï¼ˆæ•æ„Ÿè¯æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/sensitive-words`

**æƒé™**: ä»…ç®¡ç†å‘˜å¯è®¿é—®

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | GET | ç®¡ç†å‘˜ | è·å–æ•æ„Ÿè¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰|
| `/` | POST | ç®¡ç†å‘˜ | æ·»åŠ æ•æ„Ÿè¯ |
| `/{id}` | PUT | ç®¡ç†å‘˜ | æ›´æ–°æ•æ„Ÿè¯ |
| `/{id}` | DELETE | ç®¡ç†å‘˜ | åˆ é™¤æ•æ„Ÿè¯ |
| `/batch` | DELETE | ç®¡ç†å‘˜ | æ‰¹é‡åˆ é™¤æ•æ„Ÿè¯ |
| `/test` | POST | ç®¡ç†å‘˜ | æµ‹è¯•æ–‡æœ¬æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ |
| `/import` | POST | ç®¡ç†å‘˜ | æ‰¹é‡å¯¼å…¥æ•æ„Ÿè¯ |

---

### æƒé™éªŒè¯ä»£ç 

```java
/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
 */
private boolean isAdmin(Authentication authentication) {
    if (authentication == null || !authentication.isAuthenticated()) {
        return false;
    }
    User user = (User) authentication.getPrincipal();
    return "ADMIN".equals(user.getRole());
}

/**
 * æ£€æŸ¥æƒé™
 */
private Map<String, Object> checkPermission(Authentication authentication) {
    Map<String, Object> result = new HashMap<>();
    if (authentication == null || !authentication.isAuthenticated()) {
        result.put("success", false);
        result.put("message", "è¯·å…ˆç™»å½•");
        return result;
    }
    if (!isAdmin(authentication)) {
        result.put("success", false);
        result.put("message", "æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®");
        return result;
    }
    return null;
}
```

---

## å…«ã€TagsControllerï¼ˆæ ‡ç­¾æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/crawler/novels/tags`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | GET | å…¬å¼€ | è·å–æ‰€æœ‰æ ‡ç­¾ |
| `/platform/{platform}` | GET | å…¬å¼€ | æ ¹æ®å¹³å°è·å–æ ‡ç­¾ |

---

**æ³¨æ„**: æ‰€æœ‰æ¥å£éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ²¡æœ‰æƒé™éªŒè¯ï¼

---

## ä¹ã€TaskControllerï¼ˆçˆ¬è™«ä»»åŠ¡æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/crawler/tasks`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/` | GET | å…¬å¼€ | è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰|
| `/{id}` | GET | å…¬å¼€ | è·å–ä»»åŠ¡è¯¦æƒ… |
| `/` | POST | å…¬å¼€ | åˆ›å»ºä»»åŠ¡ |
| `/{id}` | PUT | å…¬å¼€ | æ›´æ–°ä»»åŠ¡ |

---

**æ³¨æ„**: æ‰€æœ‰æ¥å£éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ²¡æœ‰æƒé™éªŒè¯ï¼

---

## åã€UserControllerï¼ˆç”¨æˆ·æ§åˆ¶å™¨ï¼‰

**è·¯å¾„**: `/api/users`

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `/{id}` | GET | å…¬å¼€ | è·å–ç”¨æˆ·ä¿¡æ¯ |
| `/profile` | PUT | éœ€è¦ç™»å½• | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| `/password` | PUT | éœ€è¦ç™»å½• | ä¿®æ”¹å¯†ç  |

---

### æƒé™éªŒè¯ä»£ç 

```java
@PutMapping("/profile")
public Map<String, Object> updateProfile(@RequestBody Map<String, String> request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    return userService.updateUserProfile(userId, nickname, avatarUrl);
}
```

---

## ğŸ”’ æƒé™éªŒè¯æ–¹å¼

### æ–¹å¼ä¸€ï¼šåœ¨Controllerä¸­éªŒè¯

**é€‚ç”¨åœºæ™¯**: éœ€è¦ç™»å½•çš„æ¥å£

**ä»£ç ç¤ºä¾‹**ï¼š
```java
@PostMapping
public Map<String, Object> addComment(
        @RequestBody Map<String, Object> request,
        Authentication authentication
) {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "è¯·å…ˆç™»å½•");
        return result;
    }

    // ä¸šåŠ¡é€»è¾‘
}
```

---

### æ–¹å¼äºŒï¼šä½¿ç”¨SecurityContextHolder

**é€‚ç”¨åœºæ™¯**: éœ€è¦ç™»å½•çš„æ¥å£

**ä»£ç ç¤ºä¾‹**ï¼š
```java
@PutMapping("/profile")
public Map<String, Object> updateProfile(@RequestBody Map<String, String> request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    // ä¸šåŠ¡é€»è¾‘
}
```

---

### æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰æƒé™éªŒè¯æ–¹æ³•

**é€‚ç”¨åœºæ™¯**: éœ€è¦ç®¡ç†å‘˜æƒé™çš„æ¥å£

**ä»£ç ç¤ºä¾‹**ï¼š
```java
/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
 */
private boolean isAdmin(Authentication authentication) {
    if (authentication == null || !authentication.isAuthenticated()) {
        return false;
    }
    User user = (User) authentication.getPrincipal();
    return "ADMIN".equals(user.getRole());
}

/**
 * æ£€æŸ¥æƒé™
 */
private Map<String, Object> checkPermission(Authentication authentication) {
    Map<String, Object> result = new HashMap<>();
    if (authentication == null || !authentication.isAuthenticated()) {
        result.put("success", false);
        result.put("message", "è¯·å…ˆç™»å½•");
        return result;
    }
    if (!isAdmin(authentication)) {
        result.put("success", false);
        result.put("message", "æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®");
        return result;
    }
    return null;
}
```

---

## ğŸ“Š æƒé™é…ç½®ç»Ÿè®¡

| æƒé™ç±»å‹ | æ¥å£æ•°é‡ | å æ¯” |
|---------|---------|------|
| å…¬å¼€æ¥å£ | 25 | 53.2% |
| éœ€è¦ç™»å½• | 12 | 25.5% |
| ç®¡ç†å‘˜ | 7 | 14.9% |
| æœªç™»å½•è¿”å›ç©º | 1 | 2.1% |
| **æ€»è®¡** | **45** | **100%** |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å…¬å¼€æ¥å£é£é™©

ä»¥ä¸‹æ¥å£å®Œå…¨å…¬å¼€ï¼Œæ²¡æœ‰æƒé™éªŒè¯ï¼š

| Controller | æ¥å£ | é£é™© |
|-----------|------|------|
| ConfigController | æ‰€æœ‰æ¥å£ | çˆ¬è™«é…ç½®å¯èƒ½è¢«æ¶æ„ä¿®æ”¹ |
| CrawlerController | æ‰€æœ‰æ¥å£ | çˆ¬è™«ä»»åŠ¡å¯èƒ½è¢«æ¶æ„è§¦å‘ |
| TagsController | æ‰€æœ‰æ¥å£ | æ•°æ®å¯èƒ½è¢«æ¶æ„è®¿é—® |
| TaskController | æ‰€æœ‰æ¥å£ | ä»»åŠ¡å¯èƒ½è¢«æ¶æ„åˆ›å»º/ä¿®æ”¹ |

**å»ºè®®**: æ·»åŠ ç®¡ç†å‘˜æƒé™éªŒè¯

---

### 2. ç”¨æˆ·ä¿¡æ¯æ¥å£

ä»¥ä¸‹æ¥å£è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦æ³¨æ„æ•°æ®éšç§ï¼š

| Controller | æ¥å£ | é£é™© |
|-----------|------|------|
| UserController | `/api/users/{id}` | ç”¨æˆ·ä¿¡æ¯å¯èƒ½è¢«æ¶æ„è·å– |

**å»ºè®®**: é™åˆ¶è¿”å›å­—æ®µï¼Œéšè—æ•æ„Ÿä¿¡æ¯

---

### 3. æ‰¹é‡æŸ¥è¯¢æ¥å£

`/api/favorites/check-batch` æ¥å£ç‰¹æ®Šå¤„ç†ï¼š

- æœªç™»å½•ï¼šè¿”å›ç©ºæ•°æ®
- ç™»å½•ï¼šè¿”å›æ•°æ®

è¿™ç§å¤„ç†æ–¹å¼ä¸æ¨èï¼Œå»ºè®®ç»Ÿä¸€ä¸ºéœ€è¦ç™»å½•

---

## ğŸ”§ æƒé™é…ç½®å»ºè®®

### 1. ç»Ÿä¸€æƒé™éªŒè¯æ–¹å¼

**å»ºè®®**: ä½¿ç”¨Spring Securityæ³¨è§£

```java
@PreAuthorize("isAuthenticated()")
public Map<String, Object> addComment(...) {
    // ä¸šåŠ¡é€»è¾‘
}
```

---

### 2. ç®¡ç†å‘˜æ¥å£

**å»ºè®®**: ä½¿ç”¨@PreAuthorizeæ³¨è§£

```java
@PreAuthorize("hasRole('ADMIN')")
public Map<String, Object> addSensitiveWord(...) {
    // ä¸šåŠ¡é€»è¾‘
}
```

---

### 3. å…¬å¼€æ¥å£

**å»ºè®®**: ä½¿ç”¨@PermitAllæ³¨è§£

```java
@PermitAll
public Map<String, Object> getNovels(...) {
    // ä¸šåŠ¡é€»è¾‘
}
```

---

## ğŸ¯ æ€»ç»“

### æƒé™é…ç½®ç‰¹ç‚¹

1. **æƒé™éªŒè¯æ–¹å¼ä¸ç»Ÿä¸€**
   - æœ‰äº›ä½¿ç”¨Authenticationå‚æ•°
   - æœ‰äº›ä½¿ç”¨SecurityContextHolder
   - æœ‰äº›æ²¡æœ‰éªŒè¯

2. **å…¬å¼€æ¥å£è¿‡å¤š**
   - 53.2%çš„æ¥å£æ˜¯å®Œå…¨å…¬å¼€çš„
   - å­˜åœ¨å®‰å…¨é£é™©

3. **æƒé™éªŒè¯ä»£ç é‡å¤**
   - æ¯ä¸ªæ¥å£éƒ½éœ€è¦æ‰‹åŠ¨éªŒè¯
   - ä»£ç å†—ä½™

---

### æ”¹è¿›å»ºè®®

1. **ç»Ÿä¸€æƒé™éªŒè¯æ–¹å¼**
   - ä½¿ç”¨Spring Securityæ³¨è§£
   - å‡å°‘ä»£ç å†—ä½™

2. **å‡å°‘å…¬å¼€æ¥å£**
   - æ·»åŠ ç®¡ç†å‘˜æƒé™éªŒè¯
   - æé«˜å®‰å…¨æ€§

3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   - ç»Ÿä¸€æƒé™ä¸è¶³çš„é”™è¯¯æ¶ˆæ¯
   - æé«˜ç”¨æˆ·ä½“éªŒ

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2026-02-18 17:00
**å¼€å‘äººå‘˜**: OpenClaw

ğŸ¦
