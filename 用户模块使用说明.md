# Novel Reader ç”¨æˆ·æ¨¡å—ä½¿ç”¨è¯´æ˜

**ç‰ˆæœ¬**: v1.2  
**æ›´æ–°æ—¶é—´**: 2026-02-18

---

## ğŸ“‹ æ¦‚è¿°

ç”¨æˆ·æ¨¡å—å·²å®ç°å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶å’Œæ”¶è—ç®¡ç†åŠŸèƒ½ã€‚

### æƒé™æ§åˆ¶

| ç”¨æˆ·ç±»å‹ | å¯è®¿é—®é¡µé¢ | å¯æ“ä½œåŠŸèƒ½ |
|---------|----------|----------|
| æœªç™»å½•ç”¨æˆ· | å°è¯´æµè§ˆã€å°è¯´è¯¦æƒ… | åªèƒ½æµè§ˆï¼Œæ— æ³•æ”¶è— |
| ç™»å½•ç”¨æˆ· | å°è¯´æµè§ˆã€å°è¯´è¯¦æƒ…ã€æ”¶è—ç®¡ç†ã€ä¸ªäººä¸­å¿ƒ | æµè§ˆå°è¯´ã€æ”¶è—ç®¡ç†ã€ä¿®æ”¹ä¸ªäººä¿¡æ¯ |
| ç®¡ç†å‘˜ | æ‰€æœ‰é¡µé¢ | å…¨éƒ¨åŠŸèƒ½ + çˆ¬è™«ç®¡ç† |

---

## ğŸ” æ¥å£åˆ—è¡¨

### è®¤è¯æ¥å£ï¼ˆ4ä¸ªï¼‰

#### 1. ç”¨æˆ·æ³¨å†Œ
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Test@123"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER"
  }
}
```

---

#### 2. ç”¨æˆ·ç™»å½•
```
POST /api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test@123"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER",
    "nickname": null,
    "avatarUrl": null
  }
}
```

---

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```
GET /api/auth/me
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER",
    "nickname": null,
    "avatarUrl": null
  }
}
```

---

#### 4. ç”¨æˆ·æ³¨é”€
```
POST /api/auth/logout
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ³¨é”€æˆåŠŸ"
}
```

---

### ç”¨æˆ·æ¥å£ï¼ˆ3ä¸ªï¼‰

#### 5. è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/users/{id}
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatarUrl": "https://...",
    "role": "USER",
    "createdAt": "2026-02-18T10:00:00",
    "lastLoginTime": "2026-02-18T10:30:00"
  }
}
```

---

#### 6. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```
PUT /api/users/profile
Authorization: Bearer <token>
Content-Type: application/json

{
  "nickname": "æ–°æ˜µç§°",
  "avatarUrl": "https://..."
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ›´æ–°æˆåŠŸ",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æ–°æ˜µç§°",
    "avatarUrl": "https://...",
    "role": "USER"
  }
}
```

---

#### 7. ä¿®æ”¹å¯†ç 
```
PUT /api/users/password
Authorization: Bearer <token>
Content-Type: application/json

{
  "oldPassword": "Test@123",
  "newPassword": "NewPass@456"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

---

### æ”¶è—æ¥å£ï¼ˆ4ä¸ªï¼‰

#### 8. æ·»åŠ æ”¶è—
```
POST /api/favorites
Authorization: Bearer <token>
Content-Type: application/json

{
  "novelId": 1,
  "note": "å¾ˆå¥½çœ‹çš„å°è¯´"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ”¶è—æˆåŠŸ",
  "favorite": {
    "id": 1,
    "novelId": 1,
    "platform": "ciweimao",
    "note": "å¾ˆå¥½çœ‹çš„å°è¯´",
    "hasUpdate": 0,
    "createdAt": "2026-02-18T10:00:00",
    "novel": {
      "title": "ä¿®ä»™ä»ç³»ç»Ÿå¼€å§‹",
      "author": "é€é¥å­",
      "coverUrl": "https://...",
      "description": "..."
    }
  }
}
```

---

#### 9. å–æ¶ˆæ”¶è—
```
DELETE /api/favorites/{novelId}
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "å–æ¶ˆæˆåŠŸ"
}
```

---

#### 10. è·å–æ”¶è—åˆ—è¡¨
```
GET /api/favorites?page=0&size=10
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "content": [
    {
      "id": 1,
      "novelId": 1,
      "platform": "ciweimao",
      "note": "å¾ˆå¥½çœ‹çš„å°è¯´",
      "hasUpdate": 1,
      "novel": {
        "title": "ä¿®ä»™ä»ç³»ç»Ÿå¼€å§‹",
        "author": "é€é¥å­",
        "coverUrl": "https://..."
      }
    }
  ],
  "totalElements": 100,
  "totalPages": 10,
  "size": 10,
  "number": 0
}
```

---

#### 11. æ›´æ–°æ”¶è—å¤‡æ³¨
```
PUT /api/favorites/{novelId}/note
Authorization: Bearer <token>
Content-Type: application/json

{
  "note": "æ–°çš„å¤‡æ³¨"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ›´æ–°æˆåŠŸ",
  "favorite": {
    "id": 1,
    "note": "æ–°çš„å¤‡æ³¨"
  }
}
```

---

### åˆ†ç±»æ¥å£ï¼ˆ4ä¸ªï¼‰

#### 12. åˆ›å»ºåˆ†ç±»
```
POST /api/categories
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "ç„å¹»å°è¯´",
  "description": "æˆ‘å–œæ¬¢çš„ç„å¹»å°è¯´"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "åˆ›å»ºæˆåŠŸ",
  "category": {
    "id": 1,
    "name": "ç„å¹»å°è¯´",
    "description": "æˆ‘å–œæ¬¢çš„ç„å¹»å°è¯´",
    "sortOrder": 0
  }
}
```

---

#### 13. è·å–åˆ†ç±»åˆ—è¡¨
```
GET /api/categories
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "categories": [
    {
      "id": 1,
      "name": "ç„å¹»å°è¯´",
      "description": "æˆ‘å–œæ¬¢çš„ç„å¹»å°è¯´",
      "sortOrder": 0,
      "createdAt": "2026-02-18T10:00:00"
    }
  ]
}
```

---

#### 14. æ›´æ–°åˆ†ç±»
```
PUT /api/categories/{id}
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "ç„å¹»ä¿®ä»™",
  "description": "ç„å¹»ä¿®ä»™ç±»å°è¯´",
  "sortOrder": 1
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ›´æ–°æˆåŠŸ",
  "category": {
    "id": 1,
    "name": "ç„å¹»ä¿®ä»™",
    "description": "ç„å¹»ä¿®ä»™ç±»å°è¯´",
    "sortOrder": 1
  }
}
```

---

#### 15. åˆ é™¤åˆ†ç±»
```
DELETE /api/categories/{id}
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

## ğŸ“Š æƒé™è¯´æ˜

### å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/crawler/health` - å¥åº·æ£€æŸ¥
- `GET /api/crawler/novels/**` - å°è¯´æµè§ˆ
- `GET /api/crawler/crawlers` - çˆ¬è™«åˆ—è¡¨

### ç”¨æˆ·æ¥å£ï¼ˆéœ€è¦USERè§’è‰²ï¼‰
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `POST /api/auth/logout` - ç”¨æˆ·æ³¨é”€
- `GET /api/users/{id}` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/password` - ä¿®æ”¹å¯†ç 
- `POST /api/favorites` - æ·»åŠ æ”¶è—
- `DELETE /api/favorites/{novelId}` - å–æ¶ˆæ”¶è—
- `GET /api/favorites` - è·å–æ”¶è—åˆ—è¡¨
- `PUT /api/favorites/{novelId}/note` - æ›´æ–°æ”¶è—å¤‡æ³¨
- `POST /api/categories` - åˆ›å»ºåˆ†ç±»
- `GET /api/categories` - è·å–åˆ†ç±»åˆ—è¡¨
- `PUT /api/categories/{id}` - æ›´æ–°åˆ†ç±»
- `DELETE /api/categories/{id}` - åˆ é™¤åˆ†ç±»

### ç®¡ç†å‘˜æ¥å£ï¼ˆéœ€è¦ADMINè§’è‰²ï¼‰
- `POST /api/crawler/trigger` - è§¦å‘æ‰€æœ‰çˆ¬è™«
- `POST /api/crawler/trigger/{platform}` - è§¦å‘å¹³å°çˆ¬è™«
- `GET /api/crawler/test/{platform}` - æµ‹è¯•çˆ¬è™«
- `GET /api/crawler/status/{platform}` - è·å–å¹³å°çŠ¶æ€
- `PUT /api/crawler/configs/{id}` - æ›´æ–°é…ç½®
- `GET /api/crawler/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `GET /api/crawler/tasks/{id}` - è·å–ä»»åŠ¡è¯¦æƒ…
- `POST /api/crawler/tasks` - åˆ›å»ºä»»åŠ¡
- `PUT /api/crawler/tasks/{id}` - æ›´æ–°ä»»åŠ¡

---

## ğŸ”§ JWTä½¿ç”¨è¯´æ˜

### Tokenæ ¼å¼
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Tokenè¿‡æœŸæ—¶é—´
- é»˜è®¤ï¼š7å¤©ï¼ˆ604800000æ¯«ç§’ï¼‰
- è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•

### TokenåŒ…å«çš„ä¿¡æ¯
```json
{
  "userId": 1,
  "username": "testuser",
  "role": "USER"
}
```

---

## âš ï¸ é”™è¯¯ç 

| é”™è¯¯æƒ…å†µ | è¿”å›ä¿¡æ¯ |
|---------|---------|
| ç”¨æˆ·åå·²å­˜åœ¨ | "ç”¨æˆ·åå·²å­˜åœ¨" |
| é‚®ç®±å·²è¢«æ³¨å†Œ | "é‚®ç®±å·²è¢«æ³¨å†Œ" |
| é‚®ç®±æˆ–å¯†ç é”™è¯¯ | "é‚®ç®±æˆ–å¯†ç é”™è¯¯" |
| è´¦å·å·²è¢«ç¦ç”¨ | "è´¦å·å·²è¢«ç¦ç”¨" |
| æœªç™»å½• | "æœªç™»å½•" |
| æœªæ”¶è—è¯¥å°è¯´ | "æœªæ”¶è—è¯¥å°è¯´" |
| æ— æƒä¿®æ”¹/åˆ é™¤ | "æ— æƒä¿®æ”¹/åˆ é™¤è¯¥åˆ†ç±»" |

---

## ğŸ“ å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

### ç™»å½•ç¤ºä¾‹
```javascript
import { crawlerApi } from './api'

// ç™»å½•
const loginData = {
  email: 'test@example.com',
  password: 'Test@123'
}

const result = await crawlerApi.login(loginData)
if (result.success) {
  // ä¿å­˜Tokenåˆ°æœ¬åœ°å­˜å‚¨
  localStorage.setItem('token', result.token)
  localStorage.setItem('user', JSON.stringify(result.user))
}
```

### æ·»åŠ æ”¶è—ç¤ºä¾‹
```javascript
// æ·»åŠ æ”¶è—
const favoriteData = {
  novelId: 1,
  note: 'å¾ˆå¥½çœ‹çš„å°è¯´'
}

const result = await crawlerApi.addFavorite(favoriteData)
if (result.success) {
  console.log('æ”¶è—æˆåŠŸ')
}
```

### è·å–æ”¶è—åˆ—è¡¨ç¤ºä¾‹
```javascript
// è·å–æ”¶è—åˆ—è¡¨
const result = await crawlerApi.getFavorites({ page: 0, size: 10 })
if (result.success) {
  console.log('æ”¶è—åˆ—è¡¨ï¼š', result.content)
  console.log('æ€»æ•°ï¼š', result.totalElements)
}
```

---

## ğŸ¯ å‰ç«¯è·¯ç”±å®ˆå«ç¤ºä¾‹

```javascript
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/novels',
    component: Novels,
    meta: { requiresAuth: false }  // å…¬å¼€é¡µé¢
  },
  {
    path: '/favorites',
    component: Favorites,
    meta: { requiresAuth: true, role: 'USER' }  // éœ€è¦ç™»å½•
  },
  {
    path: '/admin/crawler',
    component: CrawlerAdmin,
    meta: { requiresAuth: true, role: 'ADMIN' }  // éœ€è¦ç®¡ç†å‘˜
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token')
  const user = JSON.parse(localStorage.getItem('user') || '{}')

  if (to.meta.requiresAuth) {
    if (!token) {
      // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
      next('/login')
      return
    }

    // æ£€æŸ¥è§’è‰²æƒé™
    if (to.meta.role && user.role !== to.meta.role) {
      // æƒé™ä¸è¶³
      next('/')
      return
    }
  }

  next()
})

export default router
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ï¼Ÿ
**A**: ç›®å‰éœ€è¦æ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­è®¾ç½®ç”¨æˆ·çš„roleä¸º"ADMIN"ã€‚åç»­å¯ä»¥æ·»åŠ ç®¡ç†å‘˜åˆ›å»ºæ¥å£ã€‚

### Q2: Tokenè¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ
**A**: Tokenè¿‡æœŸåï¼Œå‰ç«¯éœ€è¦æ‹¦æˆª401é”™è¯¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œç”¨æˆ·é‡æ–°ç™»å½•è·å–æ–°Tokenã€‚

### Q3: å¦‚ä½•åœ¨è¯·æ±‚ä¸­æºå¸¦Tokenï¼Ÿ
**A**: åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š`Authorization: Bearer <token>`

### Q4: æƒé™ä¸è¶³ä¼šè¿”å›ä»€ä¹ˆï¼Ÿ
**A**: è¿”å›403 Forbiddené”™è¯¯ï¼Œå‰ç«¯éœ€è¦æç¤ºç”¨æˆ·æƒé™ä¸è¶³ã€‚

### Q5: å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªè§’è‰²å—ï¼Ÿ
**A**: å½“å‰è®¾è®¡æ¯ä¸ªç”¨æˆ·åªæœ‰ä¸€ä¸ªè§’è‰²ï¼ˆUSERæˆ–ADMINï¼‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•ä¸ºå¤šè§’è‰²ã€‚

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-02-18  
**ç‰ˆæœ¬**: v1.2  
**çŠ¶æ€**: åç«¯å·²å®Œæˆï¼Œå‰ç«¯å¾…å®Œå–„  

ğŸ¦
