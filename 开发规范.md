# å¼€å‘è§„èŒƒ

**å¼€å‘æ—¥æœŸ**: 2026-02-18
**å¼€å‘äººå‘˜**: OpenClaw
**ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ ç›®å½•

- [æƒé™éªŒè¯è§„èŒƒ](#æƒé™éªŒè¯è§„èŒƒ)
- [é”™è¯¯å¤„ç†è§„èŒƒ](#é”™è¯¯å¤„ç†è§„èŒƒ)
- [ä»£ç é£æ ¼è§„èŒƒ](#ä»£ç é£æ ¼è§„èŒƒ)
- [æ¥å£è®¾è®¡è§„èŒƒ](#æ¥å£è®¾è®¡è§„èŒƒ)
- [å‰ç«¯å¼€å‘è§„èŒƒ](#å‰ç«¯å¼€å‘è§„èŒƒ)

---

## ğŸ”’ æƒé™éªŒè¯è§„èŒƒ

### 1. ç»Ÿä¸€æƒé™éªŒè¯æ–¹å¼

#### ä½¿ç”¨Spring Securityæ³¨è§£

**è§„åˆ™**: æ‰€æœ‰æ¥å£çš„æƒé™éªŒè¯å¿…é¡»ä½¿ç”¨Spring Securityæ³¨è§£ï¼Œä¸è¦åœ¨Controllerä¸­æ‰‹åŠ¨éªŒè¯ã€‚

---

#### æƒé™æ³¨è§£ç±»å‹

| æ³¨è§£ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `@PreAuthorize("isAuthenticated()")` | éœ€è¦ç™»å½• | ç”¨æˆ·ä¿¡æ¯ã€æ”¶è—ã€è¯„è®º |
| `@PreAuthorize("hasRole('ADMIN')")` | éœ€è¦ç®¡ç†å‘˜ | æ•æ„Ÿè¯ç®¡ç†ã€çˆ¬è™«é…ç½® |
| `@PermitAll` | å…¬å¼€æ¥å£ | å°è¯´åˆ—è¡¨ã€æ ‡ç­¾æŸ¥è¯¢ |

---

#### ç¤ºä¾‹ä»£ç 

##### 1. éœ€è¦ç™»å½•çš„æ¥å£

```java
@RestController
@RequestMapping("/api/favorites")
public class FavoriteController {

    @PreAuthorize("isAuthenticated()")
    @PostMapping
    public Map<String, Object> addFavorite(@RequestBody Map<String, Object> request) {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        Long userId = (Long) authentication.getPrincipal();
        // ä¸šåŠ¡é€»è¾‘
    }

    @PreAuthorize("isAuthenticated()")
    @DeleteMapping("/{novelId}")
    public Map<String, Object> removeFavorite(@PathVariable Long novelId) {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        Long userId = (Long) authentication.getPrincipal();
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

---

##### 2. éœ€è¦ç®¡ç†å‘˜çš„æ¥å£

```java
@RestController
@RequestMapping("/api/sensitive-words")
public class SensitiveWordController {

    @PreAuthorize("hasRole('ADMIN')")
    @GetMapping
    public Map<String, Object> getSensitiveWords(...) {
        // ä¸šåŠ¡é€»è¾‘
    }

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping
    public Map<String, Object> addSensitiveWord(@RequestBody Map<String, Object> request) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

---

##### 3. å…¬å¼€æ¥å£

```java
@RestController
@RequestMapping("/api/crawler/novels/tags")
public class TagsController {

    @PermitAll
    @GetMapping
    public ResponseEntity<Map<String, Object>> getAllTags() {
        // ä¸šåŠ¡é€»è¾‘
    }

    @PermitAll
    @GetMapping("/platform/{platform}")
    public ResponseEntity<Map<String, Object>> getTagsByPlatform(@PathVariable String platform) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

---

### 2. ç¦æ­¢çš„æƒé™éªŒè¯æ–¹å¼

#### âŒ é”™è¯¯ç¤ºä¾‹ï¼šåœ¨Controllerä¸­æ‰‹åŠ¨éªŒè¯

```java
// âŒ é”™è¯¯æ–¹å¼ï¼šä¸è¦è¿™æ ·å†™
@PostMapping
public Map<String, Object> addComment(
        @RequestBody Map<String, Object> request,
        Authentication authentication
) {
    // âŒ æ‰‹åŠ¨éªŒè¯
    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "è¯·å…ˆç™»å½•");
        return result;
    }

    // ä¸šåŠ¡é€»è¾‘
}
```

---

#### âŒ é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨SecurityContextHolderæ‰‹åŠ¨éªŒè¯

```java
// âŒ é”™è¯¯æ–¹å¼ï¼šä¸è¦è¿™æ ·å†™
@PutMapping("/profile")
public Map<String, Object> updateProfile(@RequestBody Map<String, String> request) {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    // âŒ æ‰‹åŠ¨éªŒè¯
    if (authentication == null || !authentication.isAuthenticated()) {
        Map<String, Object> error = new HashMap<>();
        error.put("success", false);
        error.put("message", "æœªç™»å½•");
        return error;
    }

    Long userId = (Long) authentication.getPrincipal();
    // ä¸šåŠ¡é€»è¾‘
}
```

---

#### âŒ é”™è¯¯ç¤ºä¾‹ï¼šè‡ªå®šä¹‰æƒé™éªŒè¯æ–¹æ³•

```java
// âŒ é”™è¯¯æ–¹å¼ï¼šä¸è¦è¿™æ ·å†™
@RestController
@RequestMapping("/api/sensitive-words")
public class SensitiveWordController {

    // âŒ è‡ªå®šä¹‰éªŒè¯æ–¹æ³•
    private boolean isAdmin(Authentication authentication) {
        if (authentication == null || !authentication.isAuthenticated()) {
            return false;
        }
        User user = (User) authentication.getPrincipal();
        return "ADMIN".equals(user.getRole());
    }

    @GetMapping
    public Map<String, Object> getSensitiveWords(Authentication authentication) {
        // âŒ æ‰‹åŠ¨éªŒè¯
        Map<String, Object> permissionCheck = checkPermission(authentication);
        if (permissionCheck != null) {
            return permissionCheck;
        }
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

---

### 3. æ­£ç¡®çš„æ–¹å¼

#### âœ… ä½¿ç”¨Spring Securityæ³¨è§£

```java
// âœ… æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨@PreAuthorizeæ³¨è§£
@RestController
@RequestMapping("/api/favorites")
public class FavoriteController {

    @PreAuthorize("isAuthenticated()")
    @PostMapping
    public Map<String, Object> addFavorite(@RequestBody Map<String, Object> request) {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        Long userId = (Long) authentication.getPrincipal();
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

---

## âŒ é”™è¯¯å¤„ç†è§„èŒƒ

### 1. ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

#### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°",
  "code": "ERROR_CODE"
}
```

---

#### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  |
|--------|------|-----------|
| `UNAUTHORIZED` | æœªç™»å½• | 401 |
| `FORBIDDEN` | æƒé™ä¸è¶³ | 403 |
| `NOT_FOUND` | èµ„æºä¸å­˜åœ¨ | 404 |
| `BAD_REQUEST` | è¯·æ±‚å‚æ•°é”™è¯¯ | 400 |
| `INTERNAL_ERROR` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | 500 |

---

### 2. ç»Ÿä¸€å¼‚å¸¸å¤„ç†

#### åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * å¤„ç†æƒé™ä¸è¶³å¼‚å¸¸
     */
    @ExceptionHandler(AccessDeniedException.class)
    public ResponseEntity<Map<String, Object>> handleAccessDeniedException(AccessDeniedException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "æƒé™ä¸è¶³");
        result.put("code", "FORBIDDEN");
        return ResponseEntity.status(HttpStatus.FORBIDDEN).body(result);
    }

    /**
     * å¤„ç†è®¤è¯å¤±è´¥å¼‚å¸¸
     */
    @ExceptionHandler(AuthenticationException.class)
    public ResponseEntity<Map<String, Object>> handleAuthenticationException(AuthenticationException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "æœªç™»å½•");
        result.put("code", "UNAUTHORIZED");
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(result);
    }

    /**
     * å¤„ç†å‚æ•°é”™è¯¯å¼‚å¸¸
     */
    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<Map<String, Object>> handleIllegalArgumentException(IllegalArgumentException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", e.getMessage());
        result.put("code", "BAD_REQUEST");
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(result);
    }

    /**
     * å¤„ç†èµ„æºä¸å­˜åœ¨å¼‚å¸¸
     */
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<Map<String, Object>> handleResourceNotFoundException(ResourceNotFoundException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", e.getMessage());
        result.put("code", "NOT_FOUND");
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(result);
    }

    /**
     * å¤„ç†å…¶ä»–å¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public ResponseEntity<Map<String, Object>> handleException(Exception e) {
        log.error("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: {}", e.getMessage(), e);
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("message", "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");
        result.put("code", "INTERNAL_ERROR");
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(result);
    }
}
```

---

### 3. è‡ªå®šä¹‰å¼‚å¸¸

#### åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»

```java
/**
 * èµ„æºä¸å­˜åœ¨å¼‚å¸¸
 */
public class ResourceNotFoundException extends RuntimeException {
    public ResourceNotFoundException(String message) {
        super(message);
    }
}
```

---

### 4. ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸

```java
@GetMapping("/{id}")
public Map<String, Object> getSensitiveWord(@PathVariable Long id) {
    SensitiveWord word = sensitiveWordRepository.findById(id)
            .orElseThrow(() -> new ResourceNotFoundException("æ•æ„Ÿè¯ä¸å­˜åœ¨"));
    // ä¸šåŠ¡é€»è¾‘
}
```

---

## ğŸ¨ ä»£ç é£æ ¼è§„èŒƒ

### 1. Controllerå‘½åè§„èŒƒ

#### è§„åˆ™

- Controllerç±»åï¼š`{Resource}Controller`
- è·¯å¾„ï¼š`/api/{resource}`ï¼ˆå¤æ•°å½¢å¼ï¼‰
- ä¾‹å¦‚ï¼š`UserController` â†’ `/api/users`

---

#### ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/users")
public class UserController {

    @GetMapping
    public Map<String, Object> getUsers() {
        // è·å–ç”¨æˆ·åˆ—è¡¨
    }

    @GetMapping("/{id}")
    public Map<String, Object> getUser(@PathVariable Long id) {
        // è·å–ç”¨æˆ·è¯¦æƒ…
    }

    @PostMapping
    public Map<String, Object> createUser(@RequestBody Map<String, Object> request) {
        // åˆ›å»ºç”¨æˆ·
    }

    @PutMapping("/{id}")
    public Map<String, Object> updateUser(@PathVariable Long id, @RequestBody Map<String, Object> request) {
        // æ›´æ–°ç”¨æˆ·
    }

    @DeleteMapping("/{id}")
    public Map<String, Object> deleteUser(@PathVariable Long id) {
        // åˆ é™¤ç”¨æˆ·
    }
}
```

---

### 2. Serviceå‘½åè§„èŒƒ

#### è§„åˆ™

- Serviceç±»åï¼š`{Resource}Service`
- ä¾‹å¦‚ï¼š`UserService`

---

### 3. Repositoryå‘½åè§„èŒƒ

#### è§„åˆ™

- Repositoryæ¥å£åï¼š`{Resource}Repository`
- ä¾‹å¦‚ï¼š`UserRepository`

---

### 4. æ³¨é‡Šè§„èŒƒ

#### Controlleræ³¨é‡Š

```java
/**
 * ç”¨æˆ·æ§åˆ¶å™¨
 */
@Slf4j
@RestController
@RequestMapping("/api/users")
public class UserController {
    // ...
}
```

---

#### æ–¹æ³•æ³¨é‡Š

```java
/**
 * è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
 *
 * @param page é¡µç 
 * @param size æ¯é¡µæ•°é‡
 * @return ç”¨æˆ·åˆ—è¡¨
 */
@GetMapping
public Map<String, Object> getUsers(
        @RequestParam(defaultValue = "0") Integer page,
        @RequestParam(defaultValue = "10") Integer size
) {
    // ...
}
```

---

## ğŸŒ æ¥å£è®¾è®¡è§„èŒƒ

### 1. æ¥å£å“åº”æ ¼å¼

#### æˆåŠŸå“åº”æ ¼å¼

```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰"
  }
}
```

---

#### å¤±è´¥å“åº”æ ¼å¼

```json
{
  "success": false,
  "message": "æ“ä½œå¤±è´¥",
  "code": "ERROR_CODE"
}
```

---

### 2. åˆ†é¡µå“åº”æ ¼å¼

```json
{
  "success": true,
  "content": [
    { "id": 1, "name": "å¼ ä¸‰" },
    { "id": 2, "name": "æå››" }
  ],
  "totalElements": 100,
  "totalPages": 10,
  "size": 10,
  "number": 0
}
```

---

### 3. HTTPæ–¹æ³•ä½¿ç”¨è§„èŒƒ

| HTTPæ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| `GET` | æŸ¥è¯¢ | `/api/users` |
| `POST` | åˆ›å»º | `/api/users` |
| `PUT` | æ›´æ–° | `/api/users/{id}` |
| `DELETE` | åˆ é™¤ | `/api/users/{id}` |

---

## ğŸ¨ å‰ç«¯å¼€å‘è§„èŒƒ

### 1. æœªç™»å½•è‡ªåŠ¨è·³è½¬

#### è§„åˆ™

**è§„åˆ™**: æ‰€æœ‰éœ€è¦ç™»å½•çš„æ¥å£ï¼Œå¦‚æœè¿”å›401ï¼ˆUNAUTHORIZEDï¼‰æˆ–"æœªç™»å½•"é”™è¯¯ï¼Œå‰ç«¯å¿…é¡»è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•ç•Œé¢ã€‚

---

#### å®ç°æ–¹å¼

##### 1. åœ¨Axiosæ‹¦æˆªå™¨ä¸­å¤„ç†

```javascript
// src/api/index.js
import router from '../router'
import { ElMessage } from 'element-plus'

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  config => {
    // æ·»åŠ Token
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  response => {
    return response.data
  },
  error => {
    // å¤„ç†401é”™è¯¯ï¼ˆæœªç™»å½•ï¼‰
    if (error.response && error.response.status === 401) {
      ElMessage.error('è¯·å…ˆç™»å½•')
      // è·³è½¬åˆ°ç™»å½•é¡µé¢
      router.push('/login')
      return Promise.reject(error)
    }

    // å¤„ç†403é”™è¯¯ï¼ˆæƒé™ä¸è¶³ï¼‰
    if (error.response && error.response.status === 403) {
      ElMessage.error('æƒé™ä¸è¶³')
      return Promise.reject(error)
    }

    // å¤„ç†å…¶ä»–é”™è¯¯
    if (error.response && error.response.data && error.response.data.message) {
      ElMessage.error(error.response.data.message)
    } else {
      ElMessage.error('è¯·æ±‚å¤±è´¥')
    }

    return Promise.reject(error)
  }
)
```

---

##### 2. åœ¨APIè°ƒç”¨ä¸­å¤„ç†

```javascript
// src/api/index.js
export default {
  // è·å–æ”¶è—åˆ—è¡¨
  getFavorites(page, size) {
    return api.get('/favorites', { params: { page, size } })
  },

  // æ·»åŠ æ”¶è—
  addFavorite(data) {
    return api.post('/favorites', data)
  }
}
```

---

##### 3. åœ¨Vueç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup>
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { useRouter } from 'vue-router'
import api from '../api'

const router = useRouter()
const favorites = ref([])

// è·å–æ”¶è—åˆ—è¡¨
const loadFavorites = async () => {
  try {
    const response = await api.getFavorites(0, 10)
    if (response && response.success) {
      favorites.value = response.content || []
    } else {
      ElMessage.error(response.message || 'åŠ è½½å¤±è´¥')
    }
  } catch (error) {
    console.error('åŠ è½½æ”¶è—åˆ—è¡¨å¤±è´¥:', error)
    // æ‹¦æˆªå™¨å·²ç»å¤„ç†äº†401é”™è¯¯ï¼Œè¿™é‡Œåªéœ€è¦æ‰“å°æ—¥å¿—
  }
}

// æ·»åŠ æ”¶è—
const addFavorite = async (novelId) => {
  try {
    const response = await api.addFavorite({ novelId })
    if (response && response.success) {
      ElMessage.success('æ”¶è—æˆåŠŸ')
      loadFavorites()
    } else {
      ElMessage.error(response.message || 'æ”¶è—å¤±è´¥')
    }
  } catch (error) {
    console.error('æ”¶è—å¤±è´¥:', error)
  }
}
</script>
```

---

### 2. é¡µé¢çº§æƒé™æ£€æŸ¥

#### åœ¨è·¯ç”±å®ˆå«ä¸­æ£€æŸ¥

```javascript
// src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import { useUserStore } from '../stores/user'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      component: Layout,
      redirect: '/dashboard',
      children: [
        {
          path: 'dashboard',
          name: 'Dashboard',
          component: () => import('../views/Dashboard.vue'),
          meta: { title: 'é¦–é¡µ' }
        },
        {
          path: 'favorites',
          name: 'Favorites',
          component: () => import('../views/Favorites.vue'),
          meta: { title: 'æˆ‘çš„æ”¶è—', requiresAuth: true }
        },
        {
          path: 'sensitive-words',
          name: 'SensitiveWords',
          component: () => import('../views/SensitiveWords.vue'),
          meta: { title: 'æ•æ„Ÿè¯ç®¡ç†', requiresAdmin: true }
        }
      ]
    }
  ]
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()

  // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•
  if (to.meta.requiresAuth && !userStore.isLoggedIn) {
    next('/login')
    return
  }

  // æ£€æŸ¥æ˜¯å¦éœ€è¦ç®¡ç†å‘˜
  if (to.meta.requiresAdmin && userStore.role !== 'ADMIN') {
    next('/')
    return
  }

  next()
})

export default router
```

---

### 3. æŒ‰é’®çº§æƒé™æ§åˆ¶

#### ä½¿ç”¨v-ifæ§åˆ¶

```vue
<template>
  <div>
    <el-button @click="edit">ç¼–è¾‘</el-button>
    <el-button v-if="userStore.role === 'ADMIN'" type="danger" @click="delete">
      åˆ é™¤
    </el-button>
  </div>
</template>

<script setup>
import { useUserStore } from '../stores/user'

const userStore = useUserStore()
</script>
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **ç»Ÿä¸€æƒé™éªŒè¯æ–¹å¼**
   - ä½¿ç”¨Spring Securityæ³¨è§£
   - ç¦æ­¢æ‰‹åŠ¨éªŒè¯

2. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   - ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨
   - ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

3. **æœªç™»å½•è‡ªåŠ¨è·³è½¬**
   - åœ¨Axiosæ‹¦æˆªå™¨ä¸­å¤„ç†
   - è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢

4. **ä»£ç é£æ ¼ç»Ÿä¸€**
   - å‘½åè§„èŒƒ
   - æ³¨é‡Šè§„èŒƒ

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2026-02-18
**å¼€å‘äººå‘˜**: OpenClaw

ğŸ¦
