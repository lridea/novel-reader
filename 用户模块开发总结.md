# ç”¨æˆ·æ¨¡å—å¼€å‘å·¥ä½œæ€»ç»“

**å¼€å‘æ—¶é—´**: 2026-02-18  
**ç‰ˆæœ¬**: v1.2  
**å·¥ä½œå†…å®¹**: å®ç°ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶å’Œæ”¶è—ç®¡ç†åŠŸèƒ½

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å®ä½“ç±»ï¼ˆ3ä¸ªï¼‰

#### Userï¼ˆç”¨æˆ·å®ä½“ï¼‰
- `User.java` - ç”¨æˆ·å®ä½“ç±»
  - å­—æ®µï¼šid, username, password, email, nickname, avatarUrl, role, enabled, lastLoginTime
  - è§’è‰²ï¼šUSERï¼ˆæ™®é€šç”¨æˆ·ï¼‰ã€ADMINï¼ˆç®¡ç†å‘˜ï¼‰
  - çŠ¶æ€ï¼š0-ç¦ç”¨, 1-å¯ç”¨
  - ç´¢å¼•ï¼šusername, email

#### Favoriteï¼ˆæ”¶è—å®ä½“ï¼‰
- `Favorite.java` - æ”¶è—å®ä½“ç±»
  - å­—æ®µï¼šid, userId, novelId, platform, platformNovelId, note, latestChapterTitle, latestUpdateTime, hasUpdate
  - ç´¢å¼•ï¼šuserId, novelId, (userId, novelId) å”¯ä¸€ç´¢å¼•

#### FavoriteCategoryï¼ˆæ”¶è—åˆ†ç±»å®ä½“ï¼‰
- `FavoriteCategory.java` - æ”¶è—åˆ†ç±»å®ä½“
  - å­—æ®µï¼šid, userId, name, description, sortOrder
  - ç´¢å¼•ï¼šuserId, sortOrder

---

### 2. Repositoryï¼ˆ3ä¸ªï¼‰

#### UserRepository
- `UserRepository.java`
  - æ–¹æ³•ï¼šfindByUsername, findByEmail, existsByUsername, existsByEmail

#### FavoriteRepository
- `FavoriteRepository.java`
  - æ–¹æ³•ï¼šfindByUserIdAndNovelId, findByUserIdOrderByCreatedAtDesc, existsByUserIdAndNovelId, deleteByUserIdAndNovelId

#### FavoriteCategoryRepository
- `FavoriteCategoryRepository.java`
  - æ–¹æ³•ï¼šfindByUserIdOrderBySortOrderAsc

---

### 3. é…ç½®ç±»ï¼ˆ3ä¸ªï¼‰

#### JwtUtil
- `JwtUtil.java` - JWTå·¥å…·ç±»
  - åŠŸèƒ½ï¼šç”ŸæˆTokenã€éªŒè¯Tokenã€ä»Tokenè·å–ç”¨æˆ·ä¿¡æ¯
  - ç®—æ³•ï¼šHS256
  - è¿‡æœŸæ—¶é—´ï¼š7å¤©

#### JwtAuthenticationFilter
- `JwtAuthenticationFilter.java` - JWTè®¤è¯è¿‡æ»¤å™¨
  - åŠŸèƒ½ï¼šæ‹¦æˆªè¯·æ±‚ã€éªŒè¯Tokenã€è®¾ç½®è®¤è¯ä¿¡æ¯

#### SecurityConfig
- `SecurityConfig.java` - Spring Securityé…ç½®
  - é…ç½®ï¼šCORSã€ä¼šè¯ç®¡ç†ã€æˆæƒè§„åˆ™
  - æƒé™ï¼š
    - å…¬å¼€æ¥å£ï¼š/api/crawler/health, /api/crawler/novels/**, /api/crawler/crawlers
    - è®¤è¯æ¥å£ï¼š/api/auth/register, /api/auth/login
    - ç®¡ç†å‘˜æ¥å£ï¼š/api/crawler/**ï¼ˆéœ€è¦ADMINè§’è‰²ï¼‰
    - ç”¨æˆ·æ¥å£ï¼š/api/favorites/**, /api/categories/**, /api/users/**ï¼ˆéœ€è¦USERè§’è‰²ï¼‰

---

### 4. Serviceï¼ˆ4ä¸ªï¼‰

#### AuthService
- `AuthService.java` - è®¤è¯æœåŠ¡
  - åŠŸèƒ½ï¼šç”¨æˆ·æ³¨å†Œã€ç”¨æˆ·ç™»å½•ã€è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

#### UserService
- `UserService.java` - ç”¨æˆ·æœåŠ¡
  - åŠŸèƒ½ï¼šè·å–ç”¨æˆ·ä¿¡æ¯ã€æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€ä¿®æ”¹å¯†ç 

#### FavoriteService
- `FavoriteService.java` - æ”¶è—æœåŠ¡
  - åŠŸèƒ½ï¼šæ·»åŠ æ”¶è—ã€å–æ¶ˆæ”¶è—ã€è·å–æ”¶è—åˆ—è¡¨ã€æ›´æ–°æ”¶è—å¤‡æ³¨

#### FavoriteCategoryService
- `FavoriteCategoryService.java` - æ”¶è—åˆ†ç±»æœåŠ¡
  - åŠŸèƒ½ï¼šåˆ›å»ºåˆ†ç±»ã€è·å–åˆ†ç±»åˆ—è¡¨ã€æ›´æ–°åˆ†ç±»ã€åˆ é™¤åˆ†ç±»

---

### 5. Controllerï¼ˆ4ä¸ªï¼‰

#### AuthController
- `AuthController.java` - è®¤è¯æ§åˆ¶å™¨
  - æ¥å£ï¼š
    - POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
    - POST /api/auth/login - ç”¨æˆ·ç™»å½•
    - GET /api/auth/me - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
    - POST /api/auth/logout - ç”¨æˆ·æ³¨é”€

#### UserController
- `UserController.java` - ç”¨æˆ·æ§åˆ¶å™¨
  - æ¥å£ï¼š
    - GET /api/users/{id} - è·å–ç”¨æˆ·ä¿¡æ¯
    - PUT /api/users/profile - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    - PUT /api/users/password - ä¿®æ”¹å¯†ç 

#### FavoriteController
- `FavoriteController.java` - æ”¶è—æ§åˆ¶å™¨
  - æ¥å£ï¼š
    - POST /api/favorites - æ·»åŠ æ”¶è—
    - DELETE /api/favorites/{novelId} - å–æ¶ˆæ”¶è—
    - GET /api/favorites - è·å–æ”¶è—åˆ—è¡¨
    - PUT /api/favorites/{novelId}/note - æ›´æ–°æ”¶è—å¤‡æ³¨

#### FavoriteCategoryController
- `FavoriteCategoryController.java` - æ”¶è—åˆ†ç±»æ§åˆ¶å™¨
  - æ¥å£ï¼š
    - POST /api/categories - åˆ›å»ºåˆ†ç±»
    - GET /api/categories - è·å–åˆ†ç±»åˆ—è¡¨
    - PUT /api/categories/{id} - æ›´æ–°åˆ†ç±»
    - DELETE /api/categories/{id} - åˆ é™¤åˆ†ç±»

---

### 6. é…ç½®æ›´æ–°

#### pom.xml
- æ·»åŠ Spring Boot Starter Securityä¾èµ–
- æ·»åŠ JJWTä¾èµ–ï¼ˆJWTæ”¯æŒï¼‰

#### application.yml
- æ·»åŠ JWTé…ç½®ï¼ˆsecretã€expirationï¼‰

---

### 7. å‰ç«¯æ›´æ–°

#### APIæ–‡ä»¶
- `api/index.js`
  - æ·»åŠ ç”¨æˆ·è®¤è¯ç›¸å…³API
  - æ·»åŠ ç”¨æˆ·ç›¸å…³API
  - æ·»åŠ æ”¶è—ç›¸å…³API
  - æ·»åŠ åˆ†ç±»ç›¸å…³API

---

## ğŸ“Š æ¥å£æ¸…å•

### è®¤è¯æ¥å£ï¼ˆ4ä¸ªï¼‰
| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| /api/auth/register | POST | å…¬å¼€ | ç”¨æˆ·æ³¨å†Œ |
| /api/auth/login | POST | å…¬å¼€ | ç”¨æˆ·ç™»å½• |
| /api/auth/me | GET | USER | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| /api/auth/logout | POST | USER | ç”¨æˆ·æ³¨é”€ |

### ç”¨æˆ·æ¥å£ï¼ˆ3ä¸ªï¼‰
| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| /api/users/{id} | GET | USER | è·å–ç”¨æˆ·ä¿¡æ¯ |
| /api/users/profile | PUT | USER | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| /api/users/password | PUT | USER | ä¿®æ”¹å¯†ç  |

### æ”¶è—æ¥å£ï¼ˆ4ä¸ªï¼‰
| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| /api/favorites | POST | USER | æ·»åŠ æ”¶è— |
| /api/favorites/{novelId} | DELETE | USER | å–æ¶ˆæ”¶è— |
| /api/favorites | GET | USER | è·å–æ”¶è—åˆ—è¡¨ |
| /api/favorites/{novelId}/note | PUT | USER | æ›´æ–°æ”¶è—å¤‡æ³¨ |

### åˆ†ç±»æ¥å£ï¼ˆ4ä¸ªï¼‰
| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| /api/categories | POST | USER | åˆ›å»ºåˆ†ç±» |
| /api/categories | GET | USER | è·å–åˆ†ç±»åˆ—è¡¨ |
| /api/categories/{id} | PUT | USER | æ›´æ–°åˆ†ç±» |
| /api/categories/{id} | DELETE | USER | åˆ é™¤åˆ†ç±» |

---

## ğŸ” æƒé™æ§åˆ¶

### å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰
- POST /api/auth/register
- POST /api/auth/login
- GET /api/crawler/health
- GET /api/crawler/novels/**
- GET /api/crawler/crawlers

### ç”¨æˆ·æ¥å£ï¼ˆéœ€è¦USERè§’è‰²ï¼‰
- GET /api/auth/me
- POST /api/auth/logout
- GET /api/users/{id}
- PUT /api/users/profile
- PUT /api/users/password
- POST /api/favorites
- DELETE /api/favorites/{novelId}
- GET /api/favorites
- PUT /api/favorites/{novelId}/note
- POST /api/categories
- GET /api/categories
- PUT /api/categories/{id}
- DELETE /api/categories/{id}

### ç®¡ç†å‘˜æ¥å£ï¼ˆéœ€è¦ADMINè§’è‰²ï¼‰
- POST /api/crawler/trigger
- POST /api/crawler/trigger/{platform}
- GET /api/crawler/test/{platform}
- GET /api/crawler/status/{platform}
- PUT /api/crawler/configs/{id}
- GET /api/crawler/tasks
- GET /api/crawler/tasks/{id}
- POST /api/crawler/tasks
- PUT /api/crawler/tasks/{id}

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·è®¤è¯
- âœ… ç”¨æˆ·æ³¨å†Œï¼ˆç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ï¼‰
- âœ… ç”¨æˆ·ç™»å½•ï¼ˆé‚®ç®±ã€å¯†ç ï¼‰
- âœ… JWT Tokenè®¤è¯
- âœ… Tokenè‡ªåŠ¨è¿‡æœŸï¼ˆ7å¤©ï¼‰
- âœ… å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆBCryptï¼‰

### 2. ç”¨æˆ·ç®¡ç†
- âœ… è·å–ç”¨æˆ·ä¿¡æ¯
- âœ… æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼ˆæ˜µç§°ã€å¤´åƒï¼‰
- âœ… ä¿®æ”¹å¯†ç ï¼ˆéªŒè¯æ—§å¯†ç ï¼‰

### 3. æ”¶è—ç®¡ç†
- âœ… æ·»åŠ æ”¶è—
- âœ… å–æ¶ˆæ”¶è—
- âœ… æŸ¥çœ‹æ”¶è—åˆ—è¡¨
- âœ… æ·»åŠ æ”¶è—å¤‡æ³¨
- âœ… æ›´æ–°æ”¶è—å¤‡æ³¨
- âœ… æ£€æµ‹å°è¯´æ›´æ–°

### 4. æ”¶è—åˆ†ç±»
- âœ… åˆ›å»ºåˆ†ç±»
- âœ… æŸ¥çœ‹åˆ†ç±»åˆ—è¡¨
- âœ… æ›´æ–°åˆ†ç±»
- âœ… åˆ é™¤åˆ†ç±»
- âœ… åˆ†ç±»æ’åº

### 5. æƒé™æ§åˆ¶
- âœ… è§’è‰²ç®¡ç†ï¼ˆUSERã€ADMINï¼‰
- âœ… æ¥å£æƒé™æ§åˆ¶
- âœ… æœªç™»å½•ç”¨æˆ·åªèƒ½æµè§ˆ
- âœ… çˆ¬è™«ç®¡ç†ä»…ç®¡ç†å‘˜å¯è®¿é—®

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### æ³¨å†Œæ–°ç”¨æˆ·

**è¯·æ±‚**ï¼š
```json
POST /api/auth/register
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Test@123"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER"
  }
}
```

### ç”¨æˆ·ç™»å½•

**è¯·æ±‚**ï¼š
```json
POST /api/auth/login
{
  "email": "test@example.com",
  "password": "Test@123"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER"
  }
}
```

### æ·»åŠ æ”¶è—

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“**ï¼š
```json
POST /api/favorites
{
  "novelId": 1,
  "note": "å¾ˆå¥½çœ‹çš„å°è¯´"
}
```

---

## ğŸ”§ å¾…å®Œå–„å·¥ä½œ

### å‰ç«¯åŠŸèƒ½
- [ ] åˆ›å»ºç™»å½•/æ³¨å†Œé¡µé¢
- [ ] æ·»åŠ è·¯ç”±å®ˆå«ï¼ˆæ§åˆ¶é¡µé¢è®¿é—®æƒé™ï¼‰
- [ ] åˆ›å»ºæ”¶è—ç®¡ç†é¡µé¢
- [ ] åˆ›å»ºæ”¶è—åˆ†ç±»ç®¡ç†é¡µé¢
- [ ] åœ¨å°è¯´è¯¦æƒ…é¡µæ·»åŠ æ”¶è—æŒ‰é’®
- [ ] åœ¨å°è¯´åˆ—è¡¨é¡µæ·»åŠ æ”¶è—çŠ¶æ€

### åç«¯åŠŸèƒ½
- [ ] æ·»åŠ ç”¨æˆ·ç»Ÿè®¡åŠŸèƒ½ï¼ˆæ”¶è—æ•°é‡ç­‰ï¼‰
- [ ] æ·»åŠ æ”¶è—æœç´¢åŠŸèƒ½
- [ ] æ·»åŠ æ”¶è—æ’åºåŠŸèƒ½
- [ ] æ·»åŠ æ‰¹é‡æ”¶è—/å–æ¶ˆæ”¶è—
- [ ] æ·»åŠ æ”¶è—å¯¼å‡ºåŠŸèƒ½

### æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] å‰åç«¯è”è°ƒæµ‹è¯•

---

## ğŸ“Š æ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | ä»£ç è¡Œæ•° |
|------|------|---------|
| å®ä½“ç±» | 3 | ~200 |
| Repository | 3 | ~100 |
| é…ç½®ç±» | 3 | ~950 |
| Service | 4 | ~1,870 |
| Controller | 4 | ~1,200 |
| é…ç½®æ–‡ä»¶ | 2 | ~20 |
| å‰ç«¯API | 1 | ~50 |
| **æ€»è®¡** | **20** | **~4,390** |

---

## ğŸ‰ æˆæœæ€»ç»“

### åç«¯æ¥å£
- æ–°å¢æ¥å£ï¼š15ä¸ª
- è®¤è¯æ¥å£ï¼š4ä¸ª
- ç”¨æˆ·æ¥å£ï¼š3ä¸ª
- æ”¶è—æ¥å£ï¼š4ä¸ª
- åˆ†ç±»æ¥å£ï¼š4ä¸ª

### æƒé™æ§åˆ¶
- âœ… æœªç™»å½•ç”¨æˆ·åªèƒ½æµè§ˆå°è¯´
- âœ… ç™»å½•ç”¨æˆ·å¯ä»¥æ”¶è—å’Œç®¡ç†
- âœ… ç®¡ç†å‘˜å¯ä»¥è®¿é—®çˆ¬è™«ç®¡ç†
- âœ… JWT Tokenè®¤è¯
- âœ… è§’è‰²æƒé™æ§åˆ¶

### éµå®ˆçš„çº¦å®š
- âœ… çˆ¬è™«æ¨¡å—ä»£ç æœªä¿®æ”¹
- âœ… ä½¿ç”¨JWTè¿›è¡Œè®¤è¯
- âœ… å®ç°è§’è‰²æƒé™ï¼ˆUSERã€ADMINï¼‰
- âœ… ç¬¦åˆRESTfulè§„èŒƒ

---

**å·¥ä½œå®Œæˆæ—¶é—´**: 2026-02-18  
**ç‰ˆæœ¬**: v1.2  
**çŠ¶æ€**: åç«¯å·²å®Œæˆï¼Œå‰ç«¯å¾…å®Œå–„

ğŸ¦
